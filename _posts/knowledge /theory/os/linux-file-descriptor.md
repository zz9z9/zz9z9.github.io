---
title: Linux - File Descriptor란 ?
date: 2025-05-19 20:25:00 +0900
categories: [지식 더하기, 이론]
tags: [Linux]
---

## 파일 디스크립터란 ?
> Linux를 포함한 유닉스 계열 운영체제에서 **열려 있는 파일이나 입출력 자원(소켓, 터미널 등)을 추상화한 숫자형 ID**

- fd는 파일을 직접 가리키는 게 아니라, 운영체제가 내부에서 파일 정보를 관리하는 테이블의 인덱스이다.

- 예시
```
int fd = open("/var/www/index.html", O_RDONLY); // 3 같은 정수값 반환

read(fd, buffer, size);
close(fd);
```

```
[ 사용자 코드 ]
   |
open() → fd = 3
   |
[ 커널 내부 ]
 ┌──────────────┐
 │ File Table   │ ← fd 3 → /var/www/index.html
 └──────────────┘
```

- 어떤 자원들이 FD를 사용할까 ?

| 자원 종류 | 예시 |
| ------- | --- |
| 파일 | 텍스트 파일, 이미지 파일 등 |
| 네트워크 소켓 | HTTP 연결, TCP 소켓 |
| 파이프	| 프로세스 간 통신용 |
| 터미널, stdin/out | 표준 입력/출력 (stdin, stdout) |
| 이벤트 디바이스 | /dev/ 아래의 장치 파일 등 |

- FD 구분

| FD 번호 | 의미 |
| ----- |-----------------|
| 0 | 표준 입력 (stdin)   |
| 1 | 표준 출력 (stdout)  |
| 2 | 표준 에러 (stderr) |
| 3 이상 | 사용자가 연 파일 또는 소켓 |

### 실제 활용 사례 : nginx
- nginx는 수많은 클라이언트와의 연결을 소켓으로 관리함 → 각 소켓은 FD로 표현됨
- epoll에 FD를 등록해서 이벤트를 기다리고, 해당 FD로 read/write 처리함
  - 예: 클라이언트 연결 하나당 FD 1개 할당됨 → 수천 연결이면 수천 FD 관리

### 소프트/하드 리밋
- 시스템이나 사용자당 열 수 있는 FD 수 제한이 있습니다: `ulimit -n`

### 특징
**1. 자원(I/O)을 추상화해서 통일적으로 관리할 수 있다**
- 이 모든 자원을 **동일한 API (read(), write(), close())** 로 처리 가능
  - 복잡한 자원별 코드 분기 없이도 일관된 처리 가능

**2. 작고 빠르다 (정수 기반 식별자)**
- FD는 단순히 **정수값(예: 3, 4, 5...)**이기 때문에:
  - 관리/비교/배열 접근이 매우 빠름 (O(1))
  - 커널의 테이블에서 빠르게 자원 조회 가능
- nginx가 epoll + FD 기반으로 수만 개 소켓을 효율적으로 관리할 수 있는 이유

**3. 커널이 자원을 직접 관리해 안정성/보안이 높다**
> 프로그램이 실수해도 커널이 보호해줌

- 사용자 입장에서 FD만 알고 있으면 됨
- 실제 자원 상태, 위치, 권한 등은 커널 내부에서 통제
- 무효한 FD 접근은 자동 차단됨 (`EBADF` 오류)

**4. 이벤트 기반 시스템과 잘 맞는다**
- epoll/kqueue/select 등 이벤트 감시는 FD를 기준으로 동작
- nginx는 모든 연결 소켓의 FD를 epoll에 등록하고, 이벤트 발생 시 FD 기반으로 처리

**5. 스케일링이 쉽다 (대규모 연결 대응)**
- 서버가 10,000개 연결을 유지할 때도:
  - 각 연결은 FD 1개로 관리
  - 커널이 자원과 상태를 추적
- 사용자 코드에서는 복잡한 상태 저장 없이 FD만 관리하면 됨

**6. 멀티프로세스/멀티스레드에서 공유 또는 분리 가능**
- FD는 fork() 후 자식에게 전달 가능
- FD는 dup(), sendmsg() 등으로 공유 가능
- nginx도 마스터가 소켓을 연 후 모든 워커에 전달함
  - nginx의 마스터-워커 모델에서 리슨 소켓 공유도 FD 덕분에 가능함





