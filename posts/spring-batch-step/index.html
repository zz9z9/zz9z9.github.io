<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Spring Batch - Step 개념" /><meta property="og:locale" content="en_US" /><meta name="description" content="개념" /><meta property="og:description" content="개념" /><link rel="canonical" href="https://zz9z9.github.io/posts/spring-batch-step/" /><meta property="og:url" content="https://zz9z9.github.io/posts/spring-batch-step/" /><meta property="og:site_name" content="zz9z9" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-09-18T22:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring Batch - Step 개념" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-09-23T22:07:26+09:00","datePublished":"2025-09-18T22:00:00+09:00","description":"개념","headline":"Spring Batch - Step 개념","mainEntityOfPage":{"@type":"WebPage","@id":"https://zz9z9.github.io/posts/spring-batch-step/"},"url":"https://zz9z9.github.io/posts/spring-batch-step/"}</script><title>Spring Batch - Step 개념 | zz9z9</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zz9z9"><meta name="application-name" content="zz9z9"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q7PWLG5WYT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q7PWLG5WYT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Soccerball.svg/1000px-Soccerball.svg.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zz9z9</a></div><div class="site-subtitle font-italic">거창한 계획보다는, 꾸준한 실행을</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zz9z9" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Spring Batch - Step 개념</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring Batch - Step 개념</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lee JaeYoon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Sep 18, 2025, 10:00 PM +0900" prep="on" > Sep 18 <i class="unloaded">2025-09-18T22:00:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Sep 23, 2025, 10:07 PM +0900" prefix="Updated " > Sep 23 <i class="unloaded">2025-09-23T22:07:26+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3956 words">21 min</span></div></div><div class="post-content"><h2 id="개념">개념</h2><hr /><h3 id="step">Step</h3><ul><li>Batch Job을 구성하는 <strong>독립된 작업</strong><li><code class="language-plaintext highlighter-rouge">BATCH_STEP_EXECUTION</code> 테이블에 저장됨<ul><li>해당 Step을 포함하는 JobExecution 정보(<code class="language-plaintext highlighter-rouge">JOB_EXECUTION_ID</code>)도 기록됨</ul></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.springframework.batch.core</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Step</span> <span class="o">{</span>

	<span class="nc">String</span> <span class="no">STEP_TYPE_KEY</span> <span class="o">=</span> <span class="s">"batch.stepType"</span><span class="o">;</span>

	<span class="nc">String</span> <span class="nf">getName</span><span class="o">();</span>

	<span class="k">default</span> <span class="kt">boolean</span> <span class="nf">isAllowStartIfComplete</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="k">default</span> <span class="kt">int</span> <span class="nf">getStartLimit</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">StepExecution</span> <span class="n">stepExecution</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JobInterruptedException</span><span class="o">;</span>

<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">Step</span> <span class="nf">step1</span><span class="o">(</span><span class="nc">JobRepository</span> <span class="n">jobRepository</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">,</span>
                  <span class="nc">FlatFileItemReader</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">reader</span><span class="o">,</span> <span class="nc">PersonItemProcessor</span> <span class="n">processor</span><span class="o">,</span> <span class="nc">JdbcBatchItemWriter</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">writer</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">StepBuilder</span><span class="o">(</span><span class="s">"step1"</span><span class="o">,</span> <span class="n">jobRepository</span><span class="o">)</span>
            <span class="o">.&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">Person</span><span class="o">&gt;</span><span class="n">chunk</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">transactionManager</span><span class="o">)</span>
            <span class="o">.</span><span class="na">reader</span><span class="o">(</span><span class="n">reader</span><span class="o">)</span>
            <span class="o">.</span><span class="na">processor</span><span class="o">(</span><span class="n">processor</span><span class="o">)</span>
            <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="n">writer</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowStartIfComplete</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.job.SimpleJob#doExecute</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doExecute</span><span class="o">(</span><span class="nc">JobExecution</span> <span class="n">execution</span><span class="o">)</span>
		<span class="kd">throws</span> <span class="nc">JobInterruptedException</span><span class="o">,</span> <span class="nc">JobRestartException</span><span class="o">,</span> <span class="nc">StartLimitExceededException</span> <span class="o">{</span>

	<span class="nc">StepExecution</span> <span class="n">stepExecution</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="k">for</span> <span class="o">(</span><span class="nc">Step</span> <span class="n">step</span> <span class="o">:</span> <span class="n">steps</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">stepExecution</span> <span class="o">=</span> <span class="n">handleStep</span><span class="o">(</span><span class="n">step</span><span class="o">,</span> <span class="n">execution</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">stepExecution</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">!=</span> <span class="nc">BatchStatus</span><span class="o">.</span><span class="na">COMPLETED</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">//</span>
			<span class="c1">// Terminate the job if a step fails</span>
			<span class="c1">//</span>
			<span class="k">break</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="c1">//</span>
	<span class="c1">// Update the job status to be the same as the last step</span>
	<span class="c1">//</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">stepExecution</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Upgrading JobExecution status: "</span> <span class="o">+</span> <span class="n">stepExecution</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="n">execution</span><span class="o">.</span><span class="na">upgradeStatus</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">.</span><span class="na">getStatus</span><span class="o">());</span>
		<span class="n">execution</span><span class="o">.</span><span class="na">setExitStatus</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">.</span><span class="na">getExitStatus</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="stepexecution">StepExecution</h3><blockquote><p>Step 실행 정보를 담고있는 객체</p></blockquote><div class="table-wrapper"><table><thead><tr><th>프로퍼티<th>정의<tbody><tr><td><strong>status</strong><td>실행 상태를 나타내는 <code class="language-plaintext highlighter-rouge">BatchStatus</code> 객체. 실행 중이면 <code class="language-plaintext highlighter-rouge">STARTED</code>, 실패하면 <code class="language-plaintext highlighter-rouge">FAILED</code>, 성공하면 <code class="language-plaintext highlighter-rouge">COMPLETED</code>.<tr><td><strong>startTime</strong><td><code class="language-plaintext highlighter-rouge">java.time.LocalDateTime</code> 실행이 시작된 시간. Step이 시작되지 않았다면 비어 있음.<tr><td><strong>endTime</strong><td><code class="language-plaintext highlighter-rouge">java.time.LocalDateTime</code> 실행이 종료된 시간 (성공/실패 여부와 관계없음). Step이 아직 종료되지 않았다면 비어 있음.<tr><td><strong>exitStatus</strong><td>실행 결과를 나타내는 <code class="language-plaintext highlighter-rouge">ExitStatus</code>. 종료 코드를 포함해 호출자에게 반환됨. Job이 아직 종료되지 않았다면 비어 있음.<tr><td><strong>executionContext</strong><td>실행 간에 유지해야 할 사용자 데이터를 담는 “property bag”.<tr><td><strong>readCount</strong><td>성공적으로 읽은 아이템 수.<tr><td><strong>writeCount</strong><td>성공적으로 기록(write)한 아이템 수.<tr><td><strong>commitCount</strong><td>이 실행에서 커밋된 트랜잭션 수.<tr><td><strong>rollbackCount</strong><td>Step이 제어하는 트랜잭션이 롤백된 횟수.<tr><td><strong>readSkipCount</strong><td>읽기 실패로 인해 스킵된 횟수.<tr><td><strong>processSkipCount</strong><td>처리 실패로 인해 스킵된 횟수.<tr><td><strong>filterCount</strong><td><code class="language-plaintext highlighter-rouge">ItemProcessor</code>에 의해 “필터링”된 아이템 수.<tr><td><strong>writeSkipCount</strong><td>쓰기 실패로 인해 스킵된 횟수.</table></div><h3 id="batchstatus-vs-exitstatus">BatchStatus vs ExitStatus</h3><ul><li>보통은 <code class="language-plaintext highlighter-rouge">BatchStatus</code>와 <code class="language-plaintext highlighter-rouge">ExitStatus</code>가 모두 <code class="language-plaintext highlighter-rouge">COMPLETED</code>이거나 <code class="language-plaintext highlighter-rouge">FAILED</code><ul><li>Job은 정상 수행되었지만, 아무 처리도 하지 않은 경우에는 <code class="language-plaintext highlighter-rouge">BatchStatus</code>는 <code class="language-plaintext highlighter-rouge">COMPLETED</code>, <code class="language-plaintext highlighter-rouge">ExitStatus</code>는 <code class="language-plaintext highlighter-rouge">NOOP</code>일수도 있다.</ul><li>좀 더 세부적으로 처리가 필요한 경우 <code class="language-plaintext highlighter-rouge">ExitStatus</code>는 커스터마이징이 가능하다.<ul><li><code class="language-plaintext highlighter-rouge">BatchStatus</code> enum, <code class="language-plaintext highlighter-rouge">ExitStatus</code>는 class</ul></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.springframework.batch.core</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">BatchStatus</span> <span class="o">{</span>

  <span class="no">COMPLETED</span><span class="o">,</span>

  <span class="no">STARTING</span><span class="o">,</span>

  <span class="no">STARTED</span><span class="o">,</span>

  <span class="no">STOPPING</span><span class="o">,</span>

  <span class="no">STOPPED</span><span class="o">,</span>

  <span class="no">FAILED</span><span class="o">,</span>

  <span class="no">ABANDONED</span><span class="o">,</span>

  <span class="no">UNKNOWN</span><span class="o">;</span>

  <span class="o">...</span>

<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.springframework.batch.core</span><span class="o">;</span>

<span class="o">...</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExitStatus</span> <span class="kd">implements</span> <span class="nc">Serializable</span><span class="o">,</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">ExitStatus</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ExitStatus</span> <span class="no">UNKNOWN</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ExitStatus</span><span class="o">(</span><span class="s">"UNKNOWN"</span><span class="o">);</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ExitStatus</span> <span class="no">EXECUTING</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ExitStatus</span><span class="o">(</span><span class="s">"EXECUTING"</span><span class="o">);</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ExitStatus</span> <span class="no">COMPLETED</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ExitStatus</span><span class="o">(</span><span class="s">"COMPLETED"</span><span class="o">);</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ExitStatus</span> <span class="no">NOOP</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ExitStatus</span><span class="o">(</span><span class="s">"NOOP"</span><span class="o">);</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ExitStatus</span> <span class="no">FAILED</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ExitStatus</span><span class="o">(</span><span class="s">"FAILED"</span><span class="o">);</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ExitStatus</span> <span class="no">STOPPED</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ExitStatus</span><span class="o">(</span><span class="s">"STOPPED"</span><span class="o">);</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">exitCode</span><span class="o">;</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">exitDescription</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">ExitStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">exitCode</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">exitCode</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">ExitStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">exitCode</span><span class="o">,</span> <span class="nc">String</span> <span class="n">exitDescription</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">exitCode</span> <span class="o">=</span> <span class="n">exitCode</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">exitDescription</span> <span class="o">=</span> <span class="n">exitDescription</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="n">exitDescription</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="o">...</span>

<span class="o">}</span>
</pre></table></code></div></div><ul><li>예:</ul><div class="table-wrapper"><table><thead><tr><th>상황<th>BatchStatus<th>ExitStatus<th>설명<tbody><tr><td>정상 처리 완료<td><code class="language-plaintext highlighter-rouge">COMPLETED</code><td><code class="language-plaintext highlighter-rouge">COMPLETED</code><td>아무 문제 없음<tr><td>처리 중 실패<td><code class="language-plaintext highlighter-rouge">FAILED</code><td><code class="language-plaintext highlighter-rouge">FAILED</code><td>시스템 오류 등으로 실패<tr><td>데이터 없음<td><code class="language-plaintext highlighter-rouge">COMPLETED</code><td><code class="language-plaintext highlighter-rouge">NO DATA</code><td>시스템 입장에서는 성공적으로 끝났지만, 처리할 데이터가 없음<tr><td>일부 스킵 발생<td><code class="language-plaintext highlighter-rouge">COMPLETED</code><td><code class="language-plaintext highlighter-rouge">COMPLETED WITH SKIPS</code><td>프레임워크는 정상 종료로 보지만, 비즈니스상 경고가 필요함<tr><td>재처리 필요<td><code class="language-plaintext highlighter-rouge">COMPLETED</code><td><code class="language-plaintext highlighter-rouge">RETRY NEEDED</code><td>실행 자체는 완료되었지만, 특정 조건으로 인해 다시 돌려야 함</table></div><h2 id="tasklet">Tasklet</h2><hr /><blockquote><p>Chunk 기반(reader → processor → writer) 처리가 굳이 필요하지 않은 경우 <br /> (예: DB stored procedure 호출, 스크립트 실행, 단순 SQL update/delete batch 등) <br /> Tasklet 기반 Step을 사용하면 Tasklet 인터페이스를 구현한 객체의 execute 메서드를 실행한다.</p></blockquote><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.tasklet.Tasklet</span>
<span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Tasklet</span> <span class="o">{</span>

	<span class="nd">@Nullable</span>
	<span class="nc">RepeatStatus</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">StepContribution</span> <span class="n">contribution</span><span class="o">,</span> <span class="nc">ChunkContext</span> <span class="n">chunkContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>

<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">MethodInvokingTaskletAdapter</code> 사용</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">MethodInvokingTaskletAdapter</span> <span class="nf">myTasklet</span><span class="o">()</span> <span class="o">{</span>
	<span class="nc">MethodInvokingTaskletAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MethodInvokingTaskletAdapter</span><span class="o">();</span>

	<span class="n">adapter</span><span class="o">.</span><span class="na">setTargetObject</span><span class="o">(</span><span class="n">fooDao</span><span class="o">());</span>
	<span class="n">adapter</span><span class="o">.</span><span class="na">setTargetMethod</span><span class="o">(</span><span class="s">"updateFoo"</span><span class="o">);</span>

	<span class="k">return</span> <span class="n">adapter</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">Tasklet</code> 인터페이스 구현</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoTasklet</span> <span class="kd">implements</span> <span class="nc">Tasklet</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">RepeatStatus</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">StepContribution</span> <span class="n">contribution</span><span class="o">,</span> <span class="nc">ChunkContext</span> <span class="n">chunkContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// doSomething</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h3 id="코드-살펴보기">코드 살펴보기</h3><ul><li><code class="language-plaintext highlighter-rouge">TaskletStepBuilder</code> 사용 (아래에서 실펴볼 Chunk 기반은 <code class="language-plaintext highlighter-rouge">SimpleStepBuilder</code> 사용)</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">Step</span> <span class="nf">step1</span><span class="o">(</span><span class="nc">JobRepository</span> <span class="n">jobRepository</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">,</span> <span class="nc">Tasklet</span> <span class="n">demoTasklet</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">StepBuilder</span><span class="o">(</span><span class="s">"step1"</span><span class="o">,</span> <span class="n">jobRepository</span><span class="o">)</span>
            <span class="o">.</span><span class="na">tasklet</span><span class="o">(</span><span class="n">demoTasklet</span><span class="o">,</span> <span class="n">transactionManager</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.builder.StepBuilder#tasklet</span>
<span class="kd">public</span> <span class="nc">TaskletStepBuilder</span> <span class="nf">tasklet</span><span class="o">(</span><span class="nc">Tasklet</span> <span class="n">tasklet</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nf">TaskletStepBuilder</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">tasklet</span><span class="o">(</span><span class="n">tasklet</span><span class="o">,</span> <span class="n">transactionManager</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.builder.TaskletStepBuilder#createTasklet</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="nc">Tasklet</span> <span class="nf">createTasklet</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">tasklet</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="chunk">Chunk</h2><hr /><blockquote><p>청크 지향 처리란, 데이터를 한 번에 하나씩(ItemReader) 읽고, 읽은 데이터를 모아서 <strong>청크(chunk)</strong>를 만드는 방식. <br /> 이렇게 모은 청크는 하나의 트랜잭션 경계 안에서 ItemWriter를 통해 한번에 쓰여진다. <br /> 읽은 아이템의 개수가 <strong>커밋 간격(commit interval)</strong>에 도달하면, ItemWriter가 청크 전체를 기록하고, 그 시점에 트랜잭션이 커밋된다.</p></blockquote><ul><li><code class="language-plaintext highlighter-rouge">Reader -&gt; Processor -&gt; Writer</code> 의사 코드</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nc">List</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Arraylist</span><span class="o">();</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">commitInterval</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
    <span class="nc">Object</span> <span class="n">item</span> <span class="o">=</span> <span class="n">itemReader</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nc">List</span> <span class="n">processedItems</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Arraylist</span><span class="o">();</span>
<span class="k">for</span><span class="o">(</span><span class="nc">Object</span> <span class="nl">item:</span> <span class="n">items</span><span class="o">){</span>
    <span class="nc">Object</span> <span class="n">processedItem</span> <span class="o">=</span> <span class="n">itemProcessor</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">processedItem</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">processedItems</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">processedItem</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">itemWriter</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">processedItems</span><span class="o">);</span>
</pre></table></code></div></div><h3 id="코드-살펴보기-1">코드 살펴보기</h3><ul><li><code class="language-plaintext highlighter-rouge">SimpleStepBuilder</code> 사용</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">Step</span> <span class="nf">step1</span><span class="o">(</span><span class="nc">JobRepository</span> <span class="n">jobRepository</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">,</span>
                  <span class="nc">FlatFileItemReader</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">reader</span><span class="o">,</span> <span class="nc">PersonItemProcessor</span> <span class="n">processor</span><span class="o">,</span> <span class="nc">JdbcBatchItemWriter</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">writer</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">StepBuilder</span><span class="o">(</span><span class="s">"step1"</span><span class="o">,</span> <span class="n">jobRepository</span><span class="o">)</span>
            <span class="o">.&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">Person</span><span class="o">&gt;</span><span class="n">chunk</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">transactionManager</span><span class="o">)</span>
            <span class="o">.</span><span class="na">reader</span><span class="o">(</span><span class="n">reader</span><span class="o">)</span>
            <span class="o">.</span><span class="na">processor</span><span class="o">(</span><span class="n">processor</span><span class="o">)</span>
            <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="n">writer</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowStartIfComplete</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.builder.SimpleStepBuilder#chunk(int)</span>
<span class="kd">public</span> <span class="nc">SimpleStepBuilder</span><span class="o">&lt;</span><span class="no">I</span><span class="o">,</span> <span class="no">O</span><span class="o">&gt;</span> <span class="nf">chunk</span><span class="o">(</span><span class="kt">int</span> <span class="n">chunkSize</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Assert</span><span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">completionPolicy</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">chunkSize</span> <span class="o">==</span> <span class="mi">0</span><span class="o">,</span>
			<span class="s">"You must specify either a chunkCompletionPolicy or a commitInterval but not both."</span><span class="o">);</span>
	<span class="k">this</span><span class="o">.</span><span class="na">chunkSize</span> <span class="o">=</span> <span class="n">chunkSize</span><span class="o">;</span>
	<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">FaultTolerantStepBuilder</code> 추가 가능</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">Step</span> <span class="nf">step1</span><span class="o">(</span><span class="nc">JobRepository</span> <span class="n">jobRepository</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">,</span>
                  <span class="nc">FlatFileItemReader</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">reader</span><span class="o">,</span> <span class="nc">PersonItemProcessor</span> <span class="n">processor</span><span class="o">,</span> <span class="nc">JdbcBatchItemWriter</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">writer</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Step</span> <span class="n">step1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StepBuilder</span><span class="o">(</span><span class="s">"step1"</span><span class="o">,</span> <span class="n">jobRepository</span><span class="o">)</span>
    <span class="o">.&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">Person</span><span class="o">&gt;</span><span class="n">chunk</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">transactionManager</span><span class="o">)</span>
    <span class="o">.</span><span class="na">reader</span><span class="o">(</span><span class="n">reader</span><span class="o">)</span>
    <span class="o">.</span><span class="na">processor</span><span class="o">(</span><span class="n">processor</span><span class="o">)</span>
    <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="n">writer</span><span class="o">)</span>
    <span class="o">.</span><span class="na">allowStartIfComplete</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">faultTolerant</span><span class="o">()</span>
    <span class="o">.</span><span class="na">skip</span><span class="o">()</span>
    <span class="o">.</span><span class="na">retry</span><span class="o">()</span>
    <span class="o">.</span><span class="na">reader</span><span class="o">()</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>

  <span class="k">return</span> <span class="n">step1</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.builder.SimpleStepBuilder#faultTolerant</span>
<span class="kd">public</span> <span class="nc">FaultTolerantStepBuilder</span><span class="o">&lt;</span><span class="no">I</span><span class="o">,</span> <span class="no">O</span><span class="o">&gt;</span> <span class="nf">faultTolerant</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nc">FaultTolerantStepBuilder</span><span class="o">&lt;&gt;(</span><span class="k">this</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">ChunkOrientedTasklet</code> 구현체 생성</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.builder.AbstractTaskletStepBuilder</span>
<span class="kd">protected</span> <span class="kd">abstract</span> <span class="nc">Tasklet</span> <span class="nf">createTasklet</span><span class="o">();</span>

<span class="kd">public</span> <span class="nc">TaskletStep</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>

	<span class="n">registerStepListenerAsChunkListener</span><span class="o">();</span>

	<span class="nc">TaskletStep</span> <span class="n">step</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TaskletStep</span><span class="o">(</span><span class="n">getName</span><span class="o">());</span>

	<span class="kd">super</span><span class="o">.</span><span class="na">enhance</span><span class="o">(</span><span class="n">step</span><span class="o">);</span>

	<span class="n">step</span><span class="o">.</span><span class="na">setChunkListeners</span><span class="o">(</span><span class="n">chunkListeners</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">ChunkListener</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>

	<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">transactionManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">step</span><span class="o">.</span><span class="na">setTransactionManager</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">transactionManager</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="k">if</span> <span class="o">(</span><span class="n">transactionAttribute</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">step</span><span class="o">.</span><span class="na">setTransactionAttribute</span><span class="o">(</span><span class="n">transactionAttribute</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="k">if</span> <span class="o">(</span><span class="n">stepOperations</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

		<span class="n">stepOperations</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RepeatTemplate</span><span class="o">();</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">taskExecutor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">TaskExecutorRepeatTemplate</span> <span class="n">repeatTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TaskExecutorRepeatTemplate</span><span class="o">();</span>
			<span class="n">repeatTemplate</span><span class="o">.</span><span class="na">setTaskExecutor</span><span class="o">(</span><span class="n">taskExecutor</span><span class="o">);</span>
			<span class="n">repeatTemplate</span><span class="o">.</span><span class="na">setThrottleLimit</span><span class="o">(</span><span class="n">throttleLimit</span><span class="o">);</span>
			<span class="n">stepOperations</span> <span class="o">=</span> <span class="n">repeatTemplate</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="o">((</span><span class="nc">RepeatTemplate</span><span class="o">)</span> <span class="n">stepOperations</span><span class="o">).</span><span class="na">setExceptionHandler</span><span class="o">(</span><span class="n">exceptionHandler</span><span class="o">);</span>

	<span class="o">}</span>
	<span class="n">step</span><span class="o">.</span><span class="na">setStepOperations</span><span class="o">(</span><span class="n">stepOperations</span><span class="o">);</span>
	<span class="n">step</span><span class="o">.</span><span class="na">setTasklet</span><span class="o">(</span><span class="n">createTasklet</span><span class="o">());</span> <span class="c1">// Tasklet 구현체 만들기</span>

	<span class="n">step</span><span class="o">.</span><span class="na">setStreams</span><span class="o">(</span><span class="n">streams</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">ItemStream</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>

	<span class="k">try</span> <span class="o">{</span>
		<span class="n">step</span><span class="o">.</span><span class="na">afterPropertiesSet</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">StepBuilderException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="k">return</span> <span class="n">step</span><span class="o">;</span>

<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.builder.SimpleStepBuilder#createTasklet</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="nc">Tasklet</span> <span class="nf">createTasklet</span><span class="o">()</span> <span class="o">{</span>
	<span class="nc">Assert</span><span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">reader</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">,</span> <span class="s">"ItemReader must be provided"</span><span class="o">);</span>
	<span class="nc">Assert</span><span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">writer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">,</span> <span class="s">"ItemWriter must be provided"</span><span class="o">);</span>
	<span class="nc">RepeatOperations</span> <span class="n">repeatOperations</span> <span class="o">=</span> <span class="n">createChunkOperations</span><span class="o">();</span>
	<span class="nc">SimpleChunkProvider</span><span class="o">&lt;</span><span class="no">I</span><span class="o">&gt;</span> <span class="n">chunkProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleChunkProvider</span><span class="o">&lt;&gt;(</span><span class="n">getReader</span><span class="o">(),</span> <span class="n">repeatOperations</span><span class="o">);</span>
	<span class="nc">SimpleChunkProcessor</span><span class="o">&lt;</span><span class="no">I</span><span class="o">,</span> <span class="no">O</span><span class="o">&gt;</span> <span class="n">chunkProcessor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleChunkProcessor</span><span class="o">&lt;&gt;(</span><span class="n">getProcessor</span><span class="o">(),</span> <span class="n">getWriter</span><span class="o">());</span>
	<span class="n">chunkProvider</span><span class="o">.</span><span class="na">setListeners</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">itemListeners</span><span class="o">));</span>
	<span class="n">chunkProvider</span><span class="o">.</span><span class="na">setMeterRegistry</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">meterRegistry</span><span class="o">);</span>
	<span class="n">chunkProcessor</span><span class="o">.</span><span class="na">setListeners</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">itemListeners</span><span class="o">));</span>
	<span class="n">chunkProcessor</span><span class="o">.</span><span class="na">setMeterRegistry</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">meterRegistry</span><span class="o">);</span>
	<span class="nc">ChunkOrientedTasklet</span><span class="o">&lt;</span><span class="no">I</span><span class="o">&gt;</span> <span class="n">tasklet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ChunkOrientedTasklet</span><span class="o">&lt;&gt;(</span><span class="n">chunkProvider</span><span class="o">,</span> <span class="n">chunkProcessor</span><span class="o">);</span>
	<span class="n">tasklet</span><span class="o">.</span><span class="na">setBuffering</span><span class="o">(!</span><span class="n">readerTransactionalQueue</span><span class="o">);</span>
	<span class="k">return</span> <span class="n">tasklet</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">ChunkOrientedTasklet</code>도 결국 <code class="language-plaintext highlighter-rouge">Tasklet</code>을 구현한 클래스</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChunkOrientedTasklet</span><span class="o">&lt;</span><span class="no">I</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Tasklet</span> <span class="o">{</span>

  <span class="o">...</span>

  <span class="nd">@Nullable</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">RepeatStatus</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">StepContribution</span> <span class="n">contribution</span><span class="o">,</span> <span class="nc">ChunkContext</span> <span class="n">chunkContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="nc">Chunk</span><span class="o">&lt;</span><span class="no">I</span><span class="o">&gt;</span> <span class="n">inputs</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Chunk</span><span class="o">&lt;</span><span class="no">I</span><span class="o">&gt;)</span> <span class="n">chunkContext</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="no">INPUTS_KEY</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">inputs</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">inputs</span> <span class="o">=</span> <span class="n">chunkProvider</span><span class="o">.</span><span class="na">provide</span><span class="o">(</span><span class="n">contribution</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">buffering</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">chunkContext</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">INPUTS_KEY</span><span class="o">,</span> <span class="n">inputs</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">chunkProcessor</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">contribution</span><span class="o">,</span> <span class="n">inputs</span><span class="o">);</span>
    <span class="n">chunkProvider</span><span class="o">.</span><span class="na">postProcess</span><span class="o">(</span><span class="n">contribution</span><span class="o">,</span> <span class="n">inputs</span><span class="o">);</span>

    <span class="c1">// Allow a message coming back from the processor to say that we</span>
    <span class="c1">// are not done yet</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">inputs</span><span class="o">.</span><span class="na">isBusy</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Inputs still busy"</span><span class="o">);</span>
      <span class="k">return</span> <span class="nc">RepeatStatus</span><span class="o">.</span><span class="na">CONTINUABLE</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="n">chunkContext</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="no">INPUTS_KEY</span><span class="o">);</span>
    <span class="n">chunkContext</span><span class="o">.</span><span class="na">setComplete</span><span class="o">();</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Inputs not busy, ended: "</span> <span class="o">+</span> <span class="n">inputs</span><span class="o">.</span><span class="na">isEnd</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="nc">RepeatStatus</span><span class="o">.</span><span class="na">continueIf</span><span class="o">(!</span><span class="n">inputs</span><span class="o">.</span><span class="na">isEnd</span><span class="o">());</span>

  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h3 id="실행-흐름">실행 흐름</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.job.SimpleStepHandler#handleStep</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">StepExecution</span> <span class="nf">handleStep</span><span class="o">(</span><span class="nc">Step</span> <span class="n">step</span><span class="o">,</span> <span class="nc">JobExecution</span> <span class="n">execution</span><span class="o">)</span>
		<span class="kd">throws</span> <span class="nc">JobInterruptedException</span><span class="o">,</span> <span class="nc">JobRestartException</span><span class="o">,</span> <span class="nc">StartLimitExceededException</span> <span class="o">{</span>

  <span class="o">...</span>

	<span class="k">if</span> <span class="o">(</span><span class="n">shouldStart</span><span class="o">(</span><span class="n">lastStepExecution</span><span class="o">,</span> <span class="n">execution</span><span class="o">,</span> <span class="n">step</span><span class="o">))</span> <span class="o">{</span>

		<span class="n">currentStepExecution</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="na">createStepExecution</span><span class="o">(</span><span class="n">step</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

    <span class="o">...</span>

		<span class="k">try</span> <span class="o">{</span>
			<span class="n">step</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">currentStepExecution</span><span class="o">);</span>
			<span class="n">currentStepExecution</span><span class="o">.</span><span class="na">getExecutionContext</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"batch.executed"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
		<span class="o">}</span>

    <span class="o">...</span>
	<span class="o">}</span>

	<span class="k">return</span> <span class="n">currentStepExecution</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.AbstractStep#execute</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">StepExecution</span> <span class="n">stepExecution</span><span class="o">)</span>
		<span class="kd">throws</span> <span class="nc">JobInterruptedException</span><span class="o">,</span> <span class="nc">UnexpectedJobExecutionException</span> <span class="o">{</span>

  <span class="o">...</span>

	<span class="k">try</span> <span class="o">(</span><span class="nc">Observation</span><span class="o">.</span><span class="na">Scope</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="na">openScope</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">getCompositeListener</span><span class="o">().</span><span class="na">beforeStep</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>
		<span class="n">open</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">.</span><span class="na">getExecutionContext</span><span class="o">());</span>

		<span class="k">try</span> <span class="o">{</span>
			<span class="n">doExecute</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">RepeatException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="n">e</span><span class="o">.</span><span class="na">getCause</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">exitStatus</span> <span class="o">=</span> <span class="nc">ExitStatus</span><span class="o">.</span><span class="na">COMPLETED</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">.</span><span class="na">getExitStatus</span><span class="o">());</span>

    <span class="o">...</span>

	<span class="o">}</span>

<span class="o">}</span>

<span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">doExecute</span><span class="o">(</span><span class="nc">StepExecution</span> <span class="n">stepExecution</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">Tasklet.execute</code>는 하나의 트랜잭션 내에서 실행된다. (<code class="language-plaintext highlighter-rouge">TransactionTemplate.execute</code>의 콜백 메서드로 호출되는 <code class="language-plaintext highlighter-rouge">ChunkTransactionCallback#doInTransaction</code>내에서 <code class="language-plaintext highlighter-rouge">Tasklet.execute</code>가 호출됨)<li><code class="language-plaintext highlighter-rouge">stepOperations.iterate(new StepContextRepeatCallback(stepExecution) { ... }</code>를 통해 chunk 단위로 반복 (따라서, chunk 단위로 트랜잭션 보장됨)</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.tasklet.TaskletStep#doExecute</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doExecute</span><span class="o">(</span><span class="nc">StepExecution</span> <span class="n">stepExecution</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="o">...</span>

	<span class="c1">// Shared semaphore per step execution, so other step executions can run</span>
	<span class="c1">// in parallel without needing the lock</span>
	<span class="kd">final</span> <span class="nc">Semaphore</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="n">createSemaphore</span><span class="o">();</span>

	<span class="n">stepOperations</span><span class="o">.</span><span class="na">iterate</span><span class="o">(</span><span class="k">new</span> <span class="nc">StepContextRepeatCallback</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">)</span> <span class="o">{</span>

		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="nc">RepeatStatus</span> <span class="nf">doInChunkContext</span><span class="o">(</span><span class="nc">RepeatContext</span> <span class="n">repeatContext</span><span class="o">,</span> <span class="nc">ChunkContext</span> <span class="n">chunkContext</span><span class="o">)</span>
				<span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

			<span class="nc">StepExecution</span> <span class="n">stepExecution</span> <span class="o">=</span> <span class="n">chunkContext</span><span class="o">.</span><span class="na">getStepContext</span><span class="o">().</span><span class="na">getStepExecution</span><span class="o">();</span>

			<span class="c1">// Before starting a new transaction, check for</span>
			<span class="c1">// interruption.</span>
			<span class="n">interruptionPolicy</span><span class="o">.</span><span class="na">checkInterrupted</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>

			<span class="nc">RepeatStatus</span> <span class="n">result</span><span class="o">;</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TransactionTemplate</span><span class="o">(</span><span class="n">transactionManager</span><span class="o">,</span> <span class="n">transactionAttribute</span><span class="o">)</span>
					<span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">ChunkTransactionCallback</span><span class="o">(</span><span class="n">chunkContext</span><span class="o">,</span> <span class="n">semaphore</span><span class="o">));</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">UncheckedTransactionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="c1">// Allow checked exceptions to be thrown inside callback</span>
				<span class="k">throw</span> <span class="o">(</span><span class="nc">Exception</span><span class="o">)</span> <span class="n">e</span><span class="o">.</span><span class="na">getCause</span><span class="o">();</span>
			<span class="o">}</span>

			<span class="n">chunkListener</span><span class="o">.</span><span class="na">afterChunk</span><span class="o">(</span><span class="n">chunkContext</span><span class="o">);</span>

			<span class="c1">// Check for interruption after transaction as well, so that</span>
			<span class="c1">// the interrupted exception is correctly propagated up to</span>
			<span class="c1">// caller</span>
			<span class="n">interruptionPolicy</span><span class="o">.</span><span class="na">checkInterrupted</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>

			<span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nc">RepeatStatus</span><span class="o">.</span><span class="na">FINISHED</span> <span class="o">:</span> <span class="n">result</span><span class="o">;</span>
		<span class="o">}</span>

	<span class="o">});</span>

<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.tasklet.TaskletStep.ChunkTransactionCallback#doInTransaction</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">RepeatStatus</span> <span class="nf">doInTransaction</span><span class="o">(</span><span class="nc">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">TransactionSynchronizationManager</span><span class="o">.</span><span class="na">registerSynchronization</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

	<span class="nc">RepeatStatus</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">RepeatStatus</span><span class="o">.</span><span class="na">CONTINUABLE</span><span class="o">;</span>

	<span class="nc">StepContribution</span> <span class="n">contribution</span> <span class="o">=</span> <span class="n">stepExecution</span><span class="o">.</span><span class="na">createStepContribution</span><span class="o">();</span>

	<span class="n">chunkListener</span><span class="o">.</span><span class="na">beforeChunk</span><span class="o">(</span><span class="n">chunkContext</span><span class="o">);</span>

	<span class="c1">// In case we need to push it back to its old value</span>
	<span class="c1">// after a commit fails...</span>
	<span class="n">oldVersion</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StepExecution</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">.</span><span class="na">getStepName</span><span class="o">(),</span> <span class="n">stepExecution</span><span class="o">.</span><span class="na">getJobExecution</span><span class="o">());</span>
	<span class="n">copy</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">,</span> <span class="n">oldVersion</span><span class="o">);</span>

	<span class="k">try</span> <span class="o">{</span>

		<span class="k">try</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">result</span> <span class="o">=</span> <span class="n">tasklet</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">contribution</span><span class="o">,</span> <span class="n">chunkContext</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">result</span> <span class="o">=</span> <span class="nc">RepeatStatus</span><span class="o">.</span><span class="na">FINISHED</span><span class="o">;</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">transactionAttribute</span><span class="o">.</span><span class="na">rollbackOn</span><span class="o">(</span><span class="n">e</span><span class="o">))</span> <span class="o">{</span>
					<span class="n">chunkContext</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="nc">ChunkListener</span><span class="o">.</span><span class="na">ROLLBACK_EXCEPTION_KEY</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
					<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">finally</span> <span class="o">{</span>

			<span class="c1">// If the step operations are asynchronous then we need</span>
			<span class="c1">// to synchronize changes to the step execution (at a</span>
			<span class="c1">// minimum). Take the lock *before* changing the step</span>
			<span class="c1">// execution.</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">semaphore</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
				<span class="n">locked</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Thread interrupted while locking for repository update"</span><span class="o">);</span>
				<span class="n">stepExecution</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">BatchStatus</span><span class="o">.</span><span class="na">STOPPED</span><span class="o">);</span>
				<span class="n">stepExecution</span><span class="o">.</span><span class="na">setTerminateOnly</span><span class="o">();</span>
				<span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
			<span class="o">}</span>

			<span class="c1">// Apply the contribution to the step</span>
			<span class="c1">// even if unsuccessful</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Applying contribution: "</span> <span class="o">+</span> <span class="n">contribution</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="n">stepExecution</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">contribution</span><span class="o">);</span>

		<span class="o">}</span>

		<span class="n">stepExecutionUpdated</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

		<span class="n">stream</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">.</span><span class="na">getExecutionContext</span><span class="o">());</span>

		<span class="k">try</span> <span class="o">{</span>
			<span class="c1">// Going to attempt a commit. If it fails this flag will</span>
			<span class="c1">// stay false and we can use that later.</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">stepExecution</span><span class="o">.</span><span class="na">getExecutionContext</span><span class="o">().</span><span class="na">isDirty</span><span class="o">())</span> <span class="o">{</span>
				<span class="n">getJobRepository</span><span class="o">().</span><span class="na">updateExecutionContext</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="n">stepExecution</span><span class="o">.</span><span class="na">incrementCommitCount</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Saving step execution before commit: "</span> <span class="o">+</span> <span class="n">stepExecution</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="n">getJobRepository</span><span class="o">().</span><span class="na">update</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// If we get to here there was a problem saving the step</span>
			<span class="c1">// execution and we have to fail.</span>
			<span class="nc">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">"JobRepository failure forcing rollback"</span><span class="o">;</span>
			<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">FatalStepExecutionException</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="k">catch</span> <span class="o">(</span><span class="nc">Error</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Rollback for Error: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
		<span class="o">}</span>
		<span class="n">rollback</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>
		<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Rollback for RuntimeException: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
		<span class="o">}</span>
		<span class="n">rollback</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>
		<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Rollback for Exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
		<span class="o">}</span>
		<span class="n">rollback</span><span class="o">(</span><span class="n">stepExecution</span><span class="o">);</span>
		<span class="c1">// Allow checked exceptions</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">UncheckedTransactionException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="k">return</span> <span class="n">result</span><span class="o">;</span>

<span class="o">}</span>
</pre></table></code></div></div><ul><li>반복 호출 (<code class="language-plaintext highlighter-rouge">stepOperations.iterate</code>) 내부</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.repeat.support.RepeatTemplate#iterate</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">RepeatStatus</span> <span class="nf">iterate</span><span class="o">(</span><span class="nc">RepeatCallback</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">RepeatContext</span> <span class="n">outer</span> <span class="o">=</span> <span class="nc">RepeatSynchronizationManager</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>

  <span class="nc">RepeatStatus</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">RepeatStatus</span><span class="o">.</span><span class="na">CONTINUABLE</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="c1">// This works with an asynchronous TaskExecutor: the</span>
    <span class="c1">// interceptors have to wait for the child processes.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">executeInternal</span><span class="o">(</span><span class="n">callback</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">finally</span> <span class="o">{</span>
    <span class="nc">RepeatSynchronizationManager</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">outer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">RepeatSynchronizationManager</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">outer</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="nc">RepeatStatus</span> <span class="nf">executeInternal</span><span class="o">(</span><span class="kd">final</span> <span class="nc">RepeatCallback</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// 반복 실행을 위한 RepeatContext 생성 (루프 상태 추적: 완료 여부, 반복 횟수 등)</span>
    <span class="nc">RepeatContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">start</span><span class="o">();</span>

    <span class="c1">// 이미 complete 표시된 상태라면 실행 안 함</span>
    <span class="kt">boolean</span> <span class="n">running</span> <span class="o">=</span> <span class="o">!</span><span class="n">isMarkedComplete</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

    <span class="c1">// 모든 리스너(open) 호출 (루프 시작 시 1회 실행)</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">RepeatListener</span> <span class="n">interceptor</span> <span class="o">:</span> <span class="n">listeners</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">interceptor</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="c1">// 리스너가 complete 시킬 수도 있으므로 다시 체크</span>
        <span class="n">running</span> <span class="o">=</span> <span class="n">running</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isMarkedComplete</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">running</span><span class="o">)</span>
            <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 기본 결과 상태는 CONTINUABLE (계속 반복 가능)</span>
    <span class="nc">RepeatStatus</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">RepeatStatus</span><span class="o">.</span><span class="na">CONTINUABLE</span><span class="o">;</span>

    <span class="c1">// 반복 상태 추적 객체 (예외 모음, 비동기 결과 등)</span>
    <span class="nc">RepeatInternalState</span> <span class="n">state</span> <span class="o">=</span> <span class="n">createInternalState</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Throwable</span><span class="o">&gt;</span> <span class="n">throwables</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">getThrowables</span><span class="o">();</span> <span class="c1">// 실행 중 발생한 예외 모음</span>
    <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Throwable</span><span class="o">&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>       <span class="c1">// 나중에 재던질 치명적 예외</span>

    <span class="k">try</span> <span class="o">{</span>

        <span class="c1">// 반복 루프 시작 (조건이 만족할 때까지 계속 콜백 실행)</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">running</span><span class="o">)</span> <span class="o">{</span>

            <span class="c1">// 각 반복(=청크 실행) 직전에 before 리스너 호출</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">RepeatListener</span> <span class="n">interceptor</span> <span class="o">:</span> <span class="n">listeners</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">interceptor</span><span class="o">.</span><span class="na">before</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
                <span class="n">running</span> <span class="o">=</span> <span class="n">running</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isMarkedComplete</span><span class="o">(</span><span class="n">context</span><span class="o">);</span> <span class="c1">// 중간에 complete 가능</span>
            <span class="o">}</span>

            <span class="c1">// 여전히 running 상태일 때만 콜백 실행</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">running</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="c1">// 콜백 실행 → 여기서 실제로 doInChunkContext 호출</span>
                    <span class="c1">// 즉, 트랜잭션 열고 청크 단위로 읽기/처리/쓰기/커밋 진행</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">getNextResult</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">callback</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>

                    <span class="c1">// after 리스너 호출</span>
                    <span class="n">executeAfterInterceptors</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">throwable</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// 콜백 중 예외 발생 시 처리 (재시도/스킵 정책 등 적용 가능)</span>
                    <span class="n">doHandle</span><span class="o">(</span><span class="n">throwable</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">deferred</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="c1">// 반복 종료 조건:</span>
                <span class="c1">// 1) 결과가 FINISHED</span>
                <span class="c1">// 2) context가 complete 상태</span>
                <span class="c1">// 3) deferred 예외 존재</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">isComplete</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">result</span><span class="o">)</span> <span class="o">||</span> <span class="n">isMarkedComplete</span><span class="o">(</span><span class="n">context</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">deferred</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">running</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// 비동기 실행 시 결과 기다리기</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">waitForResults</span><span class="o">(</span><span class="n">state</span><span class="o">));</span>

        <span class="c1">// throwables 모아둔 것 처리</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">throwable</span> <span class="o">:</span> <span class="n">throwables</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">doHandle</span><span class="o">(</span><span class="n">throwable</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">deferred</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// 내부 상태 해제</span>
        <span class="n">state</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="o">}</span>
    <span class="k">finally</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// deferred 예외가 남아 있다면 fatal → 그대로 재던짐</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">deferred</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                <span class="nc">Throwable</span> <span class="n">throwable</span> <span class="o">=</span> <span class="n">deferred</span><span class="o">.</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Handling fatal exception explicitly (rethrowing first of "</span> <span class="o">+</span> <span class="n">deferred</span><span class="o">.</span><span class="na">size</span><span class="o">()</span>
                            <span class="o">+</span> <span class="s">"): "</span> <span class="o">+</span> <span class="n">throwable</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">throwable</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                <span class="o">}</span>
                <span class="n">rethrow</span><span class="o">(</span><span class="n">throwable</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">finally</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">// 모든 리스너 close 호출 (루프 종료 시점)</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">listeners</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;)</span> <span class="o">{</span>
                    <span class="nc">RepeatListener</span> <span class="n">interceptor</span> <span class="o">=</span> <span class="n">listeners</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                    <span class="n">interceptor</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">finally</span> <span class="o">{</span>
                <span class="c1">// context 자원 정리</span>
                <span class="n">context</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// 최종 결과 반환 (CONTINUABLE or FINISHED)</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li>더이상 읽을게 없으면, <code class="language-plaintext highlighter-rouge">RepeatStatus</code>가 <code class="language-plaintext highlighter-rouge">FINISHED</code>로 된다.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.core.step.item.ChunkOrientedTasklet#execute</span>

<span class="nd">@Nullable</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">RepeatStatus</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">StepContribution</span> <span class="n">contribution</span><span class="o">,</span> <span class="nc">ChunkContext</span> <span class="n">chunkContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

	<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
	<span class="nc">Chunk</span><span class="o">&lt;</span><span class="no">I</span><span class="o">&gt;</span> <span class="n">inputs</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Chunk</span><span class="o">&lt;</span><span class="no">I</span><span class="o">&gt;)</span> <span class="n">chunkContext</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="no">INPUTS_KEY</span><span class="o">);</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">inputs</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">inputs</span> <span class="o">=</span> <span class="n">chunkProvider</span><span class="o">.</span><span class="na">provide</span><span class="o">(</span><span class="n">contribution</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">buffering</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">chunkContext</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">INPUTS_KEY</span><span class="o">,</span> <span class="n">inputs</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

  <span class="o">...</span>

	<span class="k">return</span> <span class="nc">RepeatStatus</span><span class="o">.</span><span class="na">continueIf</span><span class="o">(!</span><span class="n">inputs</span><span class="o">.</span><span class="na">isEnd</span><span class="o">());</span>

<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// org.springframework.batch.repeat.RepeatStatus</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">RepeatStatus</span> <span class="nf">continueIf</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">continuable</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">continuable</span> <span class="o">?</span> <span class="no">CONTINUABLE</span> <span class="o">:</span> <span class="no">FINISHED</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="적절한-상황-생각해보기--tasklet-기반-구성-vs-chunk-기반-구성">적절한 상황 생각해보기 : Tasklet 기반 구성 vs Chunk 기반 구성</h2><hr /><blockquote><p>각각의 특징을 고려해서 생각해보자</p></blockquote><div class="table-wrapper"><table><thead><tr><th> <th>Tasklet 기반<th>Chunk 기반<tbody><tr><td>특징<td>- Tasklet의 구현 클래스를 직접 만들어서 처리 <br /> - <code class="language-plaintext highlighter-rouge">Tasklet.execute</code>가 하나의 트랜잭션으로 처리됨 <br /> - 예외 상황에서의 재시도, skip 처리 등을 직접 구현해야함<td>- Tasklet의 구현 클래스를 <code class="language-plaintext highlighter-rouge">ChunkOrientedTasklet</code>로 이미 만들어놓음 <br /> - 해당 구현체를 사용하기 위한 구성요소 필요 (reader, processor, writer) <br /> - chunkSize 단위로 트랜잭션 나눠서 처리됨 <br /> - 예외 상황에서 재시도, skip 등의 처리들을 설정(<code class="language-plaintext highlighter-rouge">skip</code>, <code class="language-plaintext highlighter-rouge">retry</code>, <code class="language-plaintext highlighter-rouge">retryLimit</code>, <code class="language-plaintext highlighter-rouge">backOffPolicy</code> 등)으로 편리하게 처리 가능<tr><td>적절할 것 같은 상황<td>- 하나의 트랜잭션으로 처리해도 DB에 부하 및 락으로 인한 영향도가 크지 않은 경우 <br /> - 굳이 chunk 단위로 작업할 필요가 없는 경우 (특정 일자의 파일 생성/삭제, 스크립트 실행 등) <br /> - Job 실패시, 처음부터 다시 재처리해도 되는 경우<br />(데이터가 매우 적거나, 상태값 같은게 있어서 이미 처리된건 다시 처리되지 않는 경우)<td>- 하나의 트랜잭션으로 처리하기엔 DB에 부하 및 락으로 인한 영향도가 큰 경우 <br /> - 예외 상황 발생시 retry, skip 등의 처리가 필요한 경우 <br /> - Job 실패시, 실패 지점부터 다시 시작하는게 효율적인 경우</table></div><h2 id="참고-자료">참고 자료</h2><ul><li><a href="https://docs.spring.io/spring-batch/reference/domain.html">https://docs.spring.io/spring-batch/reference/domain.html</a><li><a href="https://docs.spring.io/spring-batch/reference/step/tasklet.html">https://docs.spring.io/spring-batch/reference/step/tasklet.html</a><li><a href="https://docs.spring.io/spring-batch/reference/step/chunk-oriented-processing.html">https://docs.spring.io/spring-batch/reference/step/chunk-oriented-processing.html</a><li><a href="https://docs.spring.io/spring-batch/reference/step/controlling-flow.html#batchStatusVsExitStatus">https://docs.spring.io/spring-batch/reference/step/controlling-flow.html#batchStatusVsExitStatus</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EC%A7%80%EC%8B%9D-%EB%8D%94%ED%95%98%EA%B8%B0/'>지식 더하기</a>, <a href='/categories/%EC%9D%B4%EB%A1%A0/'>이론</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring-batch/" class="post-tag no-text-decoration" >Spring Batch</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring Batch - Step 개념 - zz9z9&url=https://zz9z9.github.io/posts/spring-batch-step/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring Batch - Step 개념 - zz9z9&u=https://zz9z9.github.io/posts/spring-batch-step/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Spring Batch - Step 개념 - zz9z9&url=https://zz9z9.github.io/posts/spring-batch-step/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/daily-note-251016/">오늘 드는 생각 (251016, 은탄환)</a><li><a href="/posts/daily-note-251015/">오늘 드는 생각 (251015, 일과 공부)</a><li><a href="/posts/thinking-about-maintenance/">유지보수하기 어렵다 ?</a><li><a href="/posts/mysql-nested-loop-join/">MySQL - Nested-Loop Join 알아보기</a><li><a href="/posts/mysql-hash-join/">MySQL - Hash Join 알아보기</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a> <a class="post-tag" href="/tags/oop/">OOP</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/os/">OS</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/what-is-spring-batch/"><div class="card-body"> <span class="timeago small" > Aug 22 <i class="unloaded">2025-08-22T21:25:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Batch 알아보기</h3><div class="text-muted small"><p> Spring Batch Spring Batch는 엔터프라이즈 시스템의 핵심 일상 업무(vital for the daily operations)를 위한 견고한 배치 애플리케이션 개발을 지원하는 경량·종합 프레임워크 Spring Batch는 생산성, POJO 기반 개발, 쉬운 사용성 같은 스프링 특성을 계승하면서, 필요 시 고급 엔터프라...</p></div></div></a></div><div class="card"> <a href="/posts/spring-batch-multi-threaded-step/"><div class="card-body"> <span class="timeago small" > Aug 23 <i class="unloaded">2025-08-23T12:25:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Batch - Multi-threaded Step 알아보기</h3><div class="text-muted small"><p> 개요 Spring Batch는 병렬 처리를 위한 다양한 옵션을 제공한다. 큰 틀에서 병렬 처리는 두 가지 방식이 있다: Single-process Multi-threaded Step Parallel Steps Multi-proce...</p></div></div></a></div><div class="card"> <a href="/posts/spring-batch-job/"><div class="card-body"> <span class="timeago small" > Sep 5 <i class="unloaded">2025-09-05T21:25:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Batch - Job 개념</h3><div class="text-muted small"><p> 개념 Job 배치 작업 (출처 : https://docs.spring.io/spring-batch/reference/domain.html) 하나의 Job은 하나 이상의 Step을 가지며, 각각의 Step은 하나의 ItemReader, 하나의 ItemProcessor, 그리고 하나의 ItemWriter를 가진다. 즉, Job은 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/daily-note-250910/" class="btn btn-outline-primary" prompt="Older"><p>오늘 드는 생각 (250910, 환경)</p></a> <a href="/posts/daily-note-250923/" class="btn btn-outline-primary" prompt="Newer"><p>오늘 드는 생각 (250923, 정답)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Lee JaeYoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a> <a class="post-tag" href="/tags/oop/">OOP</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/os/">OS</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zz9z9.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
