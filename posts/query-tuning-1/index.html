<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기" /><meta property="og:locale" content="en_US" /><meta name="description" content="들어가기 전 회사에서 개발하면서 처음으로 슬로우 쿼리를 개선해보았다. 제대로 한건지는 모르겠지만 나름대로 공부해서 7초에서 0.4초까지 개선되었다. 그 과정을 간략하게 적어보고 앞으로 또 다른 슬로우 쿼리를 만나게되면 기록할 예정이다." /><meta property="og:description" content="들어가기 전 회사에서 개발하면서 처음으로 슬로우 쿼리를 개선해보았다. 제대로 한건지는 모르겠지만 나름대로 공부해서 7초에서 0.4초까지 개선되었다. 그 과정을 간략하게 적어보고 앞으로 또 다른 슬로우 쿼리를 만나게되면 기록할 예정이다." /><link rel="canonical" href="https://zz9z9.github.io/posts/query-tuning-1/" /><meta property="og:url" content="https://zz9z9.github.io/posts/query-tuning-1/" /><meta property="og:site_name" content="zz9z9" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-20T23:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-20T23:00:00+09:00","datePublished":"2022-03-20T23:00:00+09:00","description":"들어가기 전 회사에서 개발하면서 처음으로 슬로우 쿼리를 개선해보았다. 제대로 한건지는 모르겠지만 나름대로 공부해서 7초에서 0.4초까지 개선되었다. 그 과정을 간략하게 적어보고 앞으로 또 다른 슬로우 쿼리를 만나게되면 기록할 예정이다.","headline":"group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://zz9z9.github.io/posts/query-tuning-1/"},"url":"https://zz9z9.github.io/posts/query-tuning-1/"}</script><title>group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기 | zz9z9</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zz9z9"><meta name="application-name" content="zz9z9"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q7PWLG5WYT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q7PWLG5WYT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Soccerball.svg/1000px-Soccerball.svg.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zz9z9</a></div><div class="site-subtitle font-italic">거창한 계획보다는, 꾸준한 실행을</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zz9z9" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lee JaeYoon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Mar 20, 2022, 11:00 PM +0900" prep="on" > Mar 20, 2022 <i class="unloaded">2022-03-20T23:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1356 words">7 min</span></div></div><div class="post-content"><h1 id="들어가기-전">들어가기 전</h1><hr /><p>회사에서 개발하면서 처음으로 슬로우 쿼리를 개선해보았다. 제대로 한건지는 모르겠지만 나름대로 공부해서 7초에서 0.4초까지 개선되었다. 그 과정을 간략하게 적어보고 앞으로 또 다른 슬로우 쿼리를 만나게되면 기록할 예정이다.</p><h1 id="쿼리-튜닝-과정">쿼리 튜닝 과정</h1><hr /><blockquote><p>최초 쿼리 수행 시간 : 약 7초</p></blockquote><ul><li>최초 쿼리는 다음과 같다. (문제가 됐던 부분 기록, 테이블명, 컬럼명은 보안상 변경)</ul><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>    <span class="k">SELECT</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">cnt</span><span class="p">)</span> <span class="k">FROM</span>
        <span class="p">(</span><span class="k">SELECT</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span><span class="p">)</span> <span class="n">cnt</span>
             <span class="k">FROM</span> <span class="n">tbl5</span> <span class="n">og</span>
             <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="err">컬럼</span><span class="mi">2</span> <span class="k">FROM</span> <span class="n">tbl6</span> <span class="k">WHERE</span> <span class="err">컬럼</span><span class="mi">3</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">)</span> <span class="n">gu</span>
             <span class="k">ON</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="k">and</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span> <span class="o">=</span> <span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span>
                <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span><span class="p">,</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span>
                <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span><span class="p">)</span> <span class="n">tmp</span>
        <span class="k">WHERE</span> <span class="n">tmp</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">regi_qty</span><span class="p">,</span>

    <span class="p">...</span>

    <span class="k">FROM</span> <span class="n">tbl1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl2</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl2</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl3</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl3</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl4</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">4</span> <span class="o">=</span> <span class="n">tbl4</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">4</span>
    <span class="k">WHERE</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">등록일</span> <span class="o">&gt;=</span> <span class="s1">'2021-09-20'</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">등록일</span> <span class="o">&lt;</span> <span class="n">ADDDATE</span><span class="p">(</span><span class="s1">'2022-03-20'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">주문타입</span> <span class="k">IN</span> <span class="p">(</span> <span class="s1">'값1'</span> <span class="p">,</span> <span class="s1">'값2'</span> <span class="p">);</span>
</pre></table></code></div></div><h2 id="실행계획">실행계획</h2><p><img width="1086" alt="image" src="https://user-images.githubusercontent.com/64415489/160244695-657aaf1c-9722-40c3-bbc1-09c5394e1d4e.png" /></p><ul><li>문제가 될만한 부분이라고 생각했던 부분에 표시를 했다.<ul><li>og 테이블 인덱스 풀스캔<ul><li>그로 인해 임시 테이블인 derived7 테이블을 만들기 위해 조인시 많은 레코드에 접근</ul><li>임시 테이블 생성 및 정렬 (<code class="language-plaintext highlighter-rouge">Using temporary, Using filesort</code>)</ul></ul><h2 id="튜닝1">튜닝1</h2><blockquote><p>임시 테이블 생성 및 정렬하는 부분을 제거했다. (수행 시간 : 약 3.5초)</p></blockquote><ul><li>MySQL은 <code class="language-plaintext highlighter-rouge">GROUP BY</code>, <code class="language-plaintext highlighter-rouge">ORDER BY</code> 처리를 위해 임시 테이블을 만들기 때문에, <code class="language-plaintext highlighter-rouge">Using temporary, Using filesort</code>가 나오게 된다.<li>인덱스는 이미 정렬되어 있기 때문에, <code class="language-plaintext highlighter-rouge">GROUP BY</code>, <code class="language-plaintext highlighter-rouge">ORDER BY</code>를 인덱스 기준으로 하면 위해 임시 테이블을 만들 필요가 없다.<ul><li>og 테이블의 인덱스는 <code class="language-plaintext highlighter-rouge">(컬럼1,컬럼2)</code>로 구성되었기 때문에, <code class="language-plaintext highlighter-rouge">GROUP BY</code>, <code class="language-plaintext highlighter-rouge">ORDER BY</code>에 명시된 컬럼 순서를 인덱스가 구성된 순서로 변경했다.</ul></ul><h3 id="변경된-쿼리">변경된 쿼리</h3><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>    <span class="k">SELECT</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">cnt</span><span class="p">)</span> <span class="k">FROM</span>
        <span class="p">(</span><span class="k">SELECT</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span><span class="p">)</span> <span class="n">cnt</span>
             <span class="k">FROM</span> <span class="n">tbl5</span> <span class="n">og</span>
             <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="err">컬럼</span><span class="mi">2</span> <span class="k">FROM</span> <span class="n">tbl6</span> <span class="k">WHERE</span> <span class="err">컬럼</span><span class="mi">3</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">)</span> <span class="n">gu</span>
             <span class="k">ON</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="k">and</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span> <span class="o">=</span> <span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span>
                <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span>
                <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span><span class="p">)</span> <span class="n">tmp</span>
        <span class="k">WHERE</span> <span class="n">tmp</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">regi_qty</span><span class="p">,</span>

    <span class="p">...</span>

    <span class="k">FROM</span> <span class="n">tbl1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl2</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl2</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl3</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl3</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl4</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">4</span> <span class="o">=</span> <span class="n">tbl4</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">4</span>
    <span class="k">WHERE</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">등록일</span> <span class="o">&gt;=</span> <span class="s1">'2021-09-20'</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">등록일</span> <span class="o">&lt;</span> <span class="n">ADDDATE</span><span class="p">(</span><span class="s1">'2022-03-20'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">주문타입</span> <span class="k">IN</span> <span class="p">(</span> <span class="s1">'값1'</span> <span class="p">,</span> <span class="s1">'값2'</span> <span class="p">);</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">Using temporary, Using filesort</code>가 없어진 것을 볼 수 있다. <img width="1193" alt="image" src="https://user-images.githubusercontent.com/64415489/160246160-31631293-46a4-41c7-9135-49f3c7627a7b.png" /></ul><h2 id="튜닝2">튜닝2</h2><blockquote><p>드라이빙 테이블(og)에서 인덱스 풀스캔을 하지 않도록 변경했다. (수행 시간 : 약 0.4초)</p></blockquote><ul><li>드라이빙 테이블, 드리븐 테이블 중 하나라도 인덱스 풀스캔을 하게되면 결과적으로 조인 횟수가 많아지기 때문에, 풀스캔 하지 않는 방법을 찾아보았다.<li>og, gu 테이블로 인해 생성되는 임시 테이블 <code class="language-plaintext highlighter-rouge">tmp</code>은 필터 조건(등록일, 주문타입)으로 많은 레코드가 걸러진 <code class="language-plaintext highlighter-rouge">tbl1</code>의 <code class="language-plaintext highlighter-rouge">컬럼1</code>이 필터조건이 된다.<ul><li>즉, <code class="language-plaintext highlighter-rouge">tmp</code> 테이블은 <code class="language-plaintext highlighter-rouge">tbl1</code>을 <code class="language-plaintext highlighter-rouge">컬럼1</code>을 기준으로 많은 부분이 걸러지게된다.<li>따라서, og 테이블에서 애초에 모든 레코드를 가져올 필요 없이 <code class="language-plaintext highlighter-rouge">tbl1</code>의 필터 조건을 활용할 수 없을지 생각해보았다.<li>og 테이블 인덱스는 <code class="language-plaintext highlighter-rouge">(컬럼1,컬럼2)</code>인데 <code class="language-plaintext highlighter-rouge">컬럼1</code>의 경우, <code class="language-plaintext highlighter-rouge">년월일+a</code>의 규칙을 갖고 생성되기 때문에, 등록일 부분을 활용하면 될 것으로 생각했다.</ul></ul><h3 id="변경된-쿼리-1">변경된 쿼리</h3><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>    <span class="k">SELECT</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">cnt</span><span class="p">)</span> <span class="k">FROM</span>
        <span class="p">(</span><span class="k">SELECT</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span><span class="p">)</span> <span class="n">cnt</span>
             <span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="err">컬럼</span><span class="mi">2</span> <span class="k">FROM</span> <span class="n">tbl5</span> <span class="k">WHERE</span> <span class="err">컬럼</span><span class="mi">1</span> <span class="k">BETWEEN</span> <span class="s1">'20210920'</span> <span class="k">AND</span> <span class="s1">'20220321'</span><span class="p">)</span> <span class="n">og</span>
             <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="err">컬럼</span><span class="mi">2</span> <span class="k">FROM</span> <span class="n">tbl6</span> <span class="k">WHERE</span> <span class="err">컬럼</span><span class="mi">3</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">)</span> <span class="n">gu</span>
             <span class="k">ON</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="k">and</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span> <span class="o">=</span> <span class="n">gu</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span>
                <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span>
                <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">,</span> <span class="n">og</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">2</span><span class="p">)</span> <span class="n">tmp</span>
        <span class="k">WHERE</span> <span class="n">tmp</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">regi_qty</span><span class="p">,</span>

    <span class="p">...</span>

    <span class="k">FROM</span> <span class="n">tbl1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl2</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl2</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl3</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span> <span class="o">=</span> <span class="n">tbl3</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">1</span>
    <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">tbl4</span> <span class="k">ON</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">4</span> <span class="o">=</span> <span class="n">tbl4</span><span class="p">.</span><span class="err">컬럼</span><span class="mi">4</span>
    <span class="k">WHERE</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">등록일</span> <span class="o">&gt;=</span> <span class="s1">'2021-09-20'</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">등록일</span> <span class="o">&lt;</span> <span class="n">ADDDATE</span><span class="p">(</span><span class="s1">'2022-03-20'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">AND</span> <span class="n">tbl1</span><span class="p">.</span><span class="err">주문타입</span> <span class="k">IN</span> <span class="p">(</span> <span class="s1">'값1'</span> <span class="p">,</span> <span class="s1">'값2'</span> <span class="p">);</span>
</pre></table></code></div></div><ul><li>인덱스 레인지 스캔으로 변경됨과 동시에, (정확한 수치는 아니지만) 접근하는 레코드가 확연히 줄어든 것을 볼 수 있다. <img width="1160" alt="image" src="https://user-images.githubusercontent.com/64415489/160246410-b501e5b8-4bb0-47df-9155-25ec8de5670d.png" /></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EA%B2%BD%ED%97%98%ED%95%98%EA%B8%B0/'>경험하기</a>, <a href='/categories/%EC%9E%91%EC%97%85-%EB%85%B8%ED%8A%B8/'>작업 노트</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mysql/" class="post-tag no-text-decoration" >MySQL</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기 - zz9z9&url=https://zz9z9.github.io/posts/query-tuning-1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기 - zz9z9&u=https://zz9z9.github.io/posts/query-tuning-1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=group by, order by, 드라이빙 테이블 수정을 통한 쿼리 성능 개선하기 - zz9z9&url=https://zz9z9.github.io/posts/query-tuning-1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/daily-note-251016/">오늘 드는 생각 (251016, 은탄환)</a><li><a href="/posts/daily-note-251015/">오늘 드는 생각 (251015, 일과 공부)</a><li><a href="/posts/thinking-about-maintenance/">유지보수하기 어렵다 ?</a><li><a href="/posts/mysql-nested-loop-join/">MySQL - Nested-Loop Join 알아보기</a><li><a href="/posts/mysql-hash-join/">MySQL - Hash Join 알아보기</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a> <a class="post-tag" href="/tags/oop/">OOP</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/os/">OS</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/dbms-migration-intro/"><div class="card-body"> <span class="timeago small" > Oct 18 <i class="unloaded">2025-10-18T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cubrid에서 MySQL로의 여정(0) - 개요</h3><div class="text-muted small"><p> 프로젝트 개요 담당 서비스에서 사용하던 DBMS인 Cubrid를 걷어내고 MySQL로 전환 기존에 사용하던 Cubrid 9.3 버전은 이미 EOL(End of Life, 2023.03.31)이 지나 장기적인 유지보수가 어려운 상황이었음. DBA 팀에 따르면 상위 버전(10.x)으로의 업그레이드는 데이터 저장 방식과 구조 차이로 인해...</p></div></div></a></div><div class="card"> <a href="/posts/mysql-nested-loop-join/"><div class="card-body"> <span class="timeago small" > Oct 1 <i class="unloaded">2025-10-01T21:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MySQL - Nested-Loop Join 알아보기</h3><div class="text-muted small"><p> Nested-Loop Join Algorithm MySQL은 테이블 간 조인을 수행할 때, 중첩 루프 조인(Nested-Loop Join, NLJ) 알고리즘(및 그 변형)을 사용한다. MySQL 8.0.18부터는 Hash Join도 지원 NLJ : 바깥(outer) 테이블에서 한 행씩 가져와 안쪽(inne...</p></div></div></a></div><div class="card"> <a href="/posts/transaction-and-isolation-level/"><div class="card-body"> <span class="timeago small" > Aug 24, 2021 <i class="unloaded">2021-08-24T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MySQL - 트랜잭션과 격리 수준</h3><div class="text-muted small"><p> 트랜잭션과 ACID 트랜잭션이란 ? 데이터베이스 상태를 변경시키는 일련의 연산들을 논리적으로 묶을 수 있는 하나의 작업 단위 ex) 주문 - 결제 - 결제 승인 - 주문 접수 트랜잭션에는 중요한 두 가지 목적이 있다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/apache-2.2-to-2.4-issue/" class="btn btn-outline-primary" prompt="Older"><p>Apache Http Server 2.2.x -> 2.4.x 버전 업그레이드 하면서 겪었던 이슈</p></a> <a href="/posts/project-and-module/" class="btn btn-outline-primary" prompt="Newer"><p>IntelliJ - 프로젝트, 모듈이란 ?</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Lee JaeYoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a> <a class="post-tag" href="/tags/oop/">OOP</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/os/">OS</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zz9z9.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
