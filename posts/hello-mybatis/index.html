<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="JDBC / MyBatis / MyBatis-Spring 훑어보기" /><meta property="og:locale" content="en_US" /><meta name="description" content="JDBC부터 mybatis-spring까지 간단하게 사용해보면서 드는 개인적인 생각을 적어보자." /><meta property="og:description" content="JDBC부터 mybatis-spring까지 간단하게 사용해보면서 드는 개인적인 생각을 적어보자." /><link rel="canonical" href="https://zz9z9.github.io/posts/hello-mybatis/" /><meta property="og:url" content="https://zz9z9.github.io/posts/hello-mybatis/" /><meta property="og:site_name" content="zz9z9" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-12-21T22:25:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JDBC / MyBatis / MyBatis-Spring 훑어보기" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-05-25T00:39:01+09:00","datePublished":"2023-12-21T22:25:00+09:00","description":"JDBC부터 mybatis-spring까지 간단하게 사용해보면서 드는 개인적인 생각을 적어보자.","headline":"JDBC / MyBatis / MyBatis-Spring 훑어보기","mainEntityOfPage":{"@type":"WebPage","@id":"https://zz9z9.github.io/posts/hello-mybatis/"},"url":"https://zz9z9.github.io/posts/hello-mybatis/"}</script><title>JDBC / MyBatis / MyBatis-Spring 훑어보기 | zz9z9</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zz9z9"><meta name="application-name" content="zz9z9"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q7PWLG5WYT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q7PWLG5WYT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Soccerball.svg/1000px-Soccerball.svg.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zz9z9</a></div><div class="site-subtitle font-italic">거창한 계획보다는, 꾸준한 실행을</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zz9z9" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>JDBC / MyBatis / MyBatis-Spring 훑어보기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>JDBC / MyBatis / MyBatis-Spring 훑어보기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lee JaeYoon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Dec 21, 2023, 10:25 PM +0900" prep="on" > Dec 21, 2023 <i class="unloaded">2023-12-21T22:25:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, May 25, 2025, 12:39 AM +0900" prefix="Updated " > May 25, 2025 <i class="unloaded">2025-05-25T00:39:01+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2252 words">12 min</span></div></div><div class="post-content"><blockquote><p>JDBC부터 mybatis-spring까지 간단하게 사용해보면서 드는 개인적인 생각을 적어보자.</p></blockquote><ul><li>시나리오 : 회원 테이블에 회원 정보 저장 후, 회원 이력 테이블에 이력 저장하기 전 예외 발생<ul><li>상황1 : 회원 정보는 저장됨<li>상황2 : 회원, 이력 테이블에 모두 저장되지 않음</ul></ul><h1 id="jdbc">JDBC</h1><hr /><ul><li><strong>상황1</strong></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcMemberQueryServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberQueryService</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">PreparedStatement</span> <span class="n">createMemberStmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"INSERT INTO member (member_id, member_name) VALUES (?, ?)"</span><span class="o">);</span>
        <span class="n">createMemberStmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
        <span class="n">createMemberStmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="n">createMemberStmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>

        <span class="nc">PreparedStatement</span> <span class="n">createMemberHistStmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"INSERT INTO member_history (member_id, action_type, registered_at) VALUES (?, ?, ?)"</span><span class="o">);</span>
        <span class="n">createMemberHistStmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
        <span class="n">createMemberHistStmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"JOIN"</span><span class="o">);</span>

        <span class="kt">long</span> <span class="n">epochSec</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">atZone</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">()).</span><span class="na">toInstant</span><span class="o">().</span><span class="na">getEpochSecond</span><span class="o">();</span>
        <span class="n">createMemberHistStmt</span><span class="o">.</span><span class="na">setDate</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="n">epochSec</span><span class="o">));</span>

        <span class="n">causeException</span><span class="o">();</span>

        <span class="n">createMemberHistStmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="nc">Connection</span> <span class="nf">getConnection</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:mysql://localhost:3306/STUDY"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">user</span> <span class="o">=</span> <span class="s">"root"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"root"</span><span class="o">;</span>

        <span class="k">return</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><strong>상황2</strong></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcMemberQueryServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberQueryService</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">con</span><span class="o">.</span><span class="na">setAutoCommit</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

            <span class="c1">// 위와 동일 ...</span>

            <span class="n">causeException</span><span class="o">();</span>

            <span class="n">createMemberHistStmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
            <span class="n">con</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h3 id="생각하는-문제점">생각하는 문제점</h3><ul><li>비즈니스 로직(멤버 저장)에 DB관련 로직(커넥션 가져오기, SQL문 만들기 등)이 섞이게된다.<li>위와 같은 DB관련 코드가 여러 로직에 중복해서 나타나게된다.<li>쿼리문 작성시 오타날 수 있는 가능성이 있고, 있어도 컴파일 시점에선 알 수 없다.<li>statement에 파라미터 세팅시 해당 파라미터의 데이터 타입을 다 알고있어야한다. 즉, DB에 강하게 결합된 로직이 될 수밖에 없다.<li>java.sql 패키지에 정의된 데이터 타입이 강제된다.</ul><h1 id="mybatis">MyBatis</h1><hr /><blockquote><p>의존성 추가 : <code class="language-plaintext highlighter-rouge">implementation 'org.mybatis:mybatis:3.5.14'</code></p></blockquote><ul><li>MyBatis 관련 설정 파일 세팅 : <code class="language-plaintext highlighter-rouge">mybatis-config.xml</code></ul><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version = "1.0" encoding = "UTF-8"?&gt;</span>

<span class="cp">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="nt">&lt;environments</span> <span class="na">default =</span> <span class="s">"development"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;environment</span> <span class="na">id =</span> <span class="s">"development"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;transactionManager</span> <span class="na">type =</span> <span class="s">"JDBC"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;dataSource</span> <span class="na">type =</span> <span class="s">"POOLED"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name =</span> <span class="s">"driver"</span> <span class="na">value =</span> <span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name =</span> <span class="s">"url"</span> <span class="na">value =</span> <span class="s">"jdbc:mysql://localhost:3306/STUDY"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name =</span> <span class="s">"username"</span> <span class="na">value =</span> <span class="s">"root"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name =</span> <span class="s">"password"</span> <span class="na">value =</span> <span class="s">"root"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/dataSource&gt;</span>

        <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;/environments&gt;</span>

    <span class="nt">&lt;mappers&gt;</span>
        <span class="nt">&lt;mapper</span> <span class="na">resource =</span> <span class="s">"mybatis-mapper/member.xml"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;mapper</span> <span class="na">resource =</span> <span class="s">"mybatis-mapper/memberHistory.xml"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/mappers&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></table></code></div></div><ul><li>매퍼 파일 세팅</ul><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- member.xml--&gt;</span>
<span class="cp">&lt;?xml version = "1.0" encoding = "UTF-8"?&gt;</span>

<span class="cp">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace =</span> <span class="s">"member"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;insert</span> <span class="na">id =</span> <span class="s">"save"</span> <span class="na">parameterType =</span> <span class="s">"hello.persistence.model.Member"</span><span class="nt">&gt;</span>
        INSERT INTO member (member_id, member_name) VALUES (#{id}, #{name})
    <span class="nt">&lt;/insert&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</pre></table></code></div></div><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c">&lt;!--memberHistory.xml--&gt;</span>
<span class="cp">&lt;?xml version = "1.0" encoding = "UTF-8"?&gt;</span>

<span class="cp">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace =</span> <span class="s">"memberHistory"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;insert</span> <span class="na">id =</span> <span class="s">"save"</span> <span class="na">parameterType =</span> <span class="s">"hello.persistence.model.MemberHistory"</span><span class="nt">&gt;</span>
        INSERT INTO member_history (member_id, action_type, registered_at) VALUES (#{member.id}, #{actionType}, NOW())
    <span class="nt">&lt;/insert&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</pre></table></code></div></div><ul><li><strong>상황1</strong></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisMemberQueryServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberQueryService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Reader</span> <span class="n">reader</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="nc">Resources</span><span class="o">.</span><span class="na">getResourceAsReader</span><span class="o">(</span><span class="s">"mybatis-config.xml"</span><span class="o">);</span>
            <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">())</span> <span class="o">{</span> <span class="c1">// autoCommit : true (default)</span>
          <span class="nc">Member</span> <span class="n">newMember</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
          <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"member.save"</span><span class="o">,</span> <span class="n">newMember</span><span class="o">);</span>

          <span class="n">causeException</span><span class="o">();</span>

          <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"memberHistory.save"</span><span class="o">,</span> <span class="nc">MemberHistory</span><span class="o">.</span><span class="na">forJoin</span><span class="o">(</span><span class="n">newMember</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><strong>상황2</strong></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisMemberQueryServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberQueryService</span> <span class="o">{</span>
    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">(</span><span class="kc">false</span><span class="o">))</span> <span class="o">{</span>
            <span class="o">...</span>

            <span class="n">causeException</span><span class="o">();</span>

            <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"memberHistory.save"</span><span class="o">,</span> <span class="nc">MemberHistory</span><span class="o">.</span><span class="na">forJoin</span><span class="o">(</span><span class="n">newMember</span><span class="o">));</span>
            <span class="n">sqlSession</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="jdbc와-비교해서-나아졌다고-느끼는-부분">JDBC와 비교해서 나아졌다고 느끼는 부분</h3><ul><li>비즈니스 로직과 관련없는 DB 관련 로직(커넥션 얻어오기, statement 만들기 등)이 어느정도 분리됨<li><code class="language-plaintext highlighter-rouge">if</code>, <code class="language-plaintext highlighter-rouge">choose</code> 등의 기능을 통해 Dynamic 쿼리를 보다 쉽게 작성할 수 있다.</ul><h3 id="생각하는-문제점-1">생각하는 문제점</h3><ul><li>컴파일 시점에 쿼리 오류 알 수 없음 (+ mapper id도 “member.save”와 같이 문자열로 받는다.)<li>세션을 열고 닫는 부분을 신경써야한다. (비즈니스 로직에 DB 관련 로직이 남아있음)<li>매퍼 파일이 생길때마다 설정에 추가해줘야하는 번거로움</ul><h1 id="mybatis-spring">MyBatis-Spring</h1><hr /><blockquote><p>의존성 추가 : implementation ‘org.mybatis:mybatis-spring:2.1.2’ <br /></p></blockquote><ul><li><a href="https://mybatis.org/spring/index.html">공식 문서</a> 에 나와있는 버전 호환성</ul><div class="table-wrapper"><table><thead><tr><th>MyBatis-Spring<th>MyBatis<th>Spring Framework<th>Spring Batch<th>Java<tbody><tr><td>3.0<td>3.5+<td>6.0+<td>5.0+<td>Java 17+<tr><td>2.1<td>3.5+<td>5.x<td>4.x<td>Java 8+<tr><td>2.0<td>3.5+<td>5.x<td>4.x<td>Java 8+<tr><td>1.3<td>3.4+<td>3.2.2+<td>2.1+<td>Java 6+</table></div><h2 id="sqlsessiontemplate-주입">SqlSessionTemplate 주입</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">dbUrl</span> <span class="o">=</span> <span class="s">"jdbc:mysql://localhost:3306/STUDY"</span><span class="o">;</span>
      <span class="nc">String</span> <span class="n">user</span> <span class="o">=</span> <span class="s">"root"</span><span class="o">;</span>
      <span class="nc">String</span> <span class="n">pw</span> <span class="o">=</span> <span class="s">"root"</span><span class="o">;</span>
      <span class="nc">DriverManagerDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DriverManagerDataSource</span><span class="o">(</span><span class="n">dbUrl</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">pw</span><span class="o">);</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SqlSessionFactory</span> <span class="nf">sqlSessionFactory</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="nc">SqlSessionFactoryBean</span> <span class="n">factoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlSessionFactoryBean</span><span class="o">();</span>
      <span class="n">factoryBean</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
      <span class="n">factoryBean</span><span class="o">.</span><span class="na">setMapperLocations</span><span class="o">(</span><span class="k">new</span> <span class="nc">PathMatchingResourcePatternResolver</span><span class="o">().</span><span class="na">getResources</span><span class="o">(</span><span class="s">"classpath:mybatis-mapper/*.xml"</span><span class="o">));</span>
      <span class="k">return</span> <span class="n">factoryBean</span><span class="o">.</span><span class="na">getObject</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SqlSessionTemplate</span> <span class="nf">sqlSession</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">SqlSessionTemplate</span><span class="o">(</span><span class="n">sqlSessionFactory</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">MemberQueryService</span> <span class="nf">memberQueryService</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">MybatisSpringMemberQueryServiceImpl</span><span class="o">(</span><span class="n">sqlSession</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersistenceDemoApp</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ApplicationContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="nc">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">MemberQueryService</span> <span class="n">memberQueryService</span> <span class="o">=</span> <span class="o">(</span><span class="nc">MemberQueryService</span><span class="o">)</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"memberQueryService"</span><span class="o">);</span>

        <span class="n">memberQueryService</span><span class="o">.</span><span class="na">createMember</span><span class="o">(</span><span class="s">"user1"</span><span class="o">,</span> <span class="s">"Kevin"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><ul><li><strong>상황1</strong></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisSpringMemberQueryServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberQueryService</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">MybatisSpringMemberQueryServiceImpl</span><span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sqlSession</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Member</span> <span class="n">newMember</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
    <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"member.save"</span><span class="o">,</span> <span class="n">newMember</span><span class="o">);</span>

    <span class="n">causeException</span><span class="o">();</span>

    <span class="n">sqlSessionTemplate</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"memberHistory.save"</span><span class="o">,</span> <span class="nc">MemberHistory</span><span class="o">.</span><span class="na">forJoin</span><span class="o">(</span><span class="n">newMember</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>위 예제에서 sqlSession의 구현체인 sqlSessionTemplate에서 commit, rollback을 직접호출하면 <code class="language-plaintext highlighter-rouge">UnsupportedOperationException</code> 발생, 기본적으로는 autoCommit된다. 또한 SqlSession에는 setAutoCommit하는 부분도 없다.<br /> 따라서, 상황2를 위해서는 <code class="language-plaintext highlighter-rouge">org.springframework.transaction.TransactionManager</code>가 필요 <br /><br /> <a href="https://mybatis.org/spring/ko/transactions.html">공식 문서</a>에 따르면 <strong><em>“마이바티스 스프링 연동모듈을 사용하는 중요한 이유중 하나는 마이바티스가 스프링 트랜잭션에 자연스럽게 연동될수 있다는 것이다. 마이바티스에 종속되는 새로운 트랜잭션 관리를 만드는 것보다는 마이바티스 스프링 연동모듈이 스프링의 DataSourceTransactionManager과 융합되는 것이 좋다.”</em></strong> 라고 되어있는게 mybatis-spring 자체적으로는 트랜잭션 관리하는 부분을 제공하지 않고 스프링쪽의 <code class="language-plaintext highlighter-rouge">TransactionManager</code>가 필요하다는 얘기인 것 같기도하다.</p></blockquote><ul><li>AppConfig.java에 PlatformTransactionManager 빈 선언 및 MemberQueryService에 주입</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">DataSourceTransactionManager</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">MemberQueryService</span> <span class="nf">memberQueryService</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nf">MybatisSpringMemberQueryServiceImpl</span><span class="o">(</span><span class="n">sqlSession</span><span class="o">(),</span> <span class="n">transactionManager</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><strong>상황2</strong></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisSpringMemberQueryServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberQueryService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MybatisSpringMemberQueryServiceImpl</span><span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sqlSession</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">transactionManager</span> <span class="o">=</span> <span class="n">transactionManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">TransactionStatus</span> <span class="n">txStatus</span> <span class="o">=</span> <span class="n">transactionManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">(</span><span class="k">new</span> <span class="nc">DefaultTransactionDefinition</span><span class="o">());</span>
      <span class="nc">Member</span> <span class="n">newMember</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
      <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"member.save"</span><span class="o">,</span> <span class="n">newMember</span><span class="o">);</span>

      <span class="n">causeException</span><span class="o">();</span>

      <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"memberHistory.save"</span><span class="o">,</span> <span class="nc">MemberHistory</span><span class="o">.</span><span class="na">forJoin</span><span class="o">(</span><span class="n">newMember</span><span class="o">));</span>
      <span class="n">transactionManager</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">txStatus</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h3 id="mybatis와-비교해서-나아졌다고-느끼는-부분">MyBatis와 비교해서 나아졌다고 느끼는 부분</h3><ul><li>SqlSessionFactory 사용해서 SqlSession을 매번 생성하고 커밋/롤백후 닫는 작업을 안해줘도된다.<li>SqlSessionTemplate은 Thread-safe하다. (<a href="https://mybatis.org/spring/sqlsession.html">참고</a>)</ul><h3 id="생각하는-문제점-2">생각하는 문제점</h3><ul><li>트랜잭션 처리를 위해 TransactionManager, TransactionStatus 등 이전에 비해 의존해야될 객체들이 더 생긴다.<li>비즈니스 로직에 트랜잭션 관련 처리 코드가 섞인다.<li>statement 문자열로 선언</ul><h2 id="위-상황2-개선해보기--transactional-사용">위 상황2 개선해보기 : @Transactional 사용</h2><ul><li>AppConfig.java에 <code class="language-plaintext highlighter-rouge">@EnableTransactionManagement</code> 선언</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisSpringMemberQueryServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberQueryService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MybatisSpringMemberQueryServiceImpl</span><span class="o">(</span><span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sqlSession</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Member</span> <span class="n">newMember</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
      <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"member.save"</span><span class="o">,</span> <span class="n">newMember</span><span class="o">);</span>

      <span class="n">causeException</span><span class="o">();</span>

      <span class="n">sqlSession</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"memberHistory.save"</span><span class="o">,</span> <span class="nc">MemberHistory</span><span class="o">.</span><span class="na">forJoin</span><span class="o">(</span><span class="n">newMember</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h3 id="전과-비교해서-나아졌다고-느끼는-부분">전과 비교해서 나아졌다고 느끼는 부분</h3><ul><li><code class="language-plaintext highlighter-rouge">TransactionStatus</code>, <code class="language-plaintext highlighter-rouge">PlatformTransactionManager</code>에 의존하지 않아도된다.<li>비즈니스 로직에서 트랜잭션 관련 부분이 사라진다.</ul><h2 id="statement-id-문자열로-입력하는-부분-개선하기--매퍼-인터페이스-사용">Statement id 문자열로 입력하는 부분 개선하기 : 매퍼 인터페이스 사용</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberMapper</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberHistoryMapper</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="nc">MemberHistory</span> <span class="n">memberHistory</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">AppConfig.java</code>에 Mapper 빈 추가</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">MemberMapper</span> <span class="nf">memberMapper</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">MapperFactoryBean</span><span class="o">&lt;</span><span class="nc">MemberMapper</span><span class="o">&gt;</span> <span class="n">factoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MapperFactoryBean</span><span class="o">&lt;&gt;(</span><span class="nc">MemberMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">factoryBean</span><span class="o">.</span><span class="na">setSqlSessionFactory</span><span class="o">(</span><span class="n">sqlSessionFactory</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">factoryBean</span><span class="o">.</span><span class="na">getObject</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">MemberHistoryMapper</span> <span class="nf">memberHistoryMapper</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">MapperFactoryBean</span><span class="o">&lt;</span><span class="nc">MemberHistoryMapper</span><span class="o">&gt;</span> <span class="n">factoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MapperFactoryBean</span><span class="o">&lt;&gt;(</span><span class="nc">MemberHistoryMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">factoryBean</span><span class="o">.</span><span class="na">setSqlSessionFactory</span><span class="o">(</span><span class="n">sqlSessionFactory</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">factoryBean</span><span class="o">.</span><span class="na">getObject</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">MemberQueryService</span> <span class="nf">memberQueryService</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nf">MybatisSpringMemberQueryServiceImpl</span><span class="o">(</span><span class="n">memberMapper</span><span class="o">(),</span> <span class="n">memberHistoryMapper</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li>또는, <code class="language-plaintext highlighter-rouge">@MapperScan</code>을 사용하면<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="nd">@MapperScan</span><span class="o">(</span><span class="s">"hello.persistence.mybatis.mapper"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">MemberQueryService</span> <span class="nf">memberQueryService</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// TODO : MapperScan 사용할 때는 의존성 주입 어떻게하지 ??</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><li>매퍼 파일의 namespace에는 매퍼 인터페이스의 full package 명을 적어야한다.<ul><li>member.xml : <code class="language-plaintext highlighter-rouge">&lt;mapper namespace = "hello.persistence.mybatis.mapper.MemberMapper"&gt;</code><li>memberHistory.xml : <code class="language-plaintext highlighter-rouge">&lt;mapper namespace = "hello.persistence.mybatis.mapper.MemberHistoryMapper"&gt;</code></ul></ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisSpringMemberQueryServiceImpl</span> <span class="kd">implements</span> <span class="nc">MemberQueryService</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="nc">MemberMapper</span> <span class="n">memberMapper</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">MemberHistoryMapper</span> <span class="n">memberHistoryMapper</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">MybatisSpringMemberQueryServiceImpl</span><span class="o">(</span><span class="nc">MemberMapper</span> <span class="n">memberMapper</span><span class="o">,</span> <span class="nc">MemberHistoryMapper</span> <span class="n">memberHistoryMapper</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memberMapper</span> <span class="o">=</span> <span class="n">memberMapper</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memberHistoryMapper</span> <span class="o">=</span> <span class="n">memberHistoryMapper</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Member</span> <span class="n">newMember</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
    <span class="n">memberMapper</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">newMember</span><span class="o">);</span>

    <span class="n">causeException</span><span class="o">();</span>

    <span class="n">memberHistoryMapper</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="nc">MemberHistory</span><span class="o">.</span><span class="na">forJoin</span><span class="o">(</span><span class="n">newMember</span><span class="o">));</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h3 id="전과-비교해서-나아졌다고-느끼는-부분-1">전과 비교해서 나아졌다고 느끼는 부분</h3><ul><li>DB 관련된 코드가 비즈니스 로직에서 완전히 분리된다.<li>Statement id가 잘못 맵핑된 경우 컴파일 시점에서 발견될 수 있다. (즉, 문자열 오타 등으로 인해 없는 Statement 호출할 일은 없음)</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EC%A7%80%EC%8B%9D-%EB%8D%94%ED%95%98%EA%B8%B0/'>지식 더하기</a>, <a href='/categories/hello-world-%EA%B5%AC%ED%98%84/'>Hello-World 구현</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mybatis/" class="post-tag no-text-decoration" >Mybatis</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JDBC / MyBatis / MyBatis-Spring 훑어보기 - zz9z9&url=https://zz9z9.github.io/posts/hello-mybatis/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JDBC / MyBatis / MyBatis-Spring 훑어보기 - zz9z9&u=https://zz9z9.github.io/posts/hello-mybatis/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=JDBC / MyBatis / MyBatis-Spring 훑어보기 - zz9z9&url=https://zz9z9.github.io/posts/hello-mybatis/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-entity-manager-persistence-context/">EntityManager와 영속성 컨텍스트</a><li><a href="/posts/jpa-id-generation-strategy/">JPA/Hibernate ID 생성 전략</a><li><a href="/posts/aws-vpc/">AWS VPC(Virtual Private Cloud) - 기초 개념</a><li><a href="/posts/aws-efs/">AWS EFS(Elastic File System) - 기초 개념</a><li><a href="/posts/aws-intro/">AWS - 상품 살펴보기</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-boot-project-setting/"><div class="card-body"> <span class="timeago small" > Nov 14, 2025 <i class="unloaded">2025-11-14T22:25:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IntelliJ에서 프로젝트 세팅하기 (Gradle, Spring Boot)</h3><div class="text-muted small"><p> Gradle 기반 스프링 부트 프로젝트를 세팅해보자. 프로젝트 만들기 실습환경 : IntelliJ IDEA 2025.2 경로 : File &gt; New &gt; Project... 프로젝트 세팅 File &gt; Project Structure Project SDK 프로젝트에서 사용할 JDK 버전을 지정 ...</p></div></div></a></div><div class="card"> <a href="/posts/transaction-and-isolation-level/"><div class="card-body"> <span class="timeago small" > Aug 24, 2021 <i class="unloaded">2021-08-24T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MySQL - 트랜잭션과 격리 수준</h3><div class="text-muted small"><p> 트랜잭션과 ACID 트랜잭션이란 ? 데이터베이스 상태를 변경시키는 일련의 연산들을 논리적으로 묶을 수 있는 하나의 작업 단위 ex) 주문 - 결제 - 결제 승인 - 주문 접수 트랜잭션에는 중요한 두 가지 목적이 있다. ...</p></div></div></a></div><div class="card"> <a href="/posts/data-modeling/"><div class="card-body"> <span class="timeago small" > Aug 25, 2021 <i class="unloaded">2021-08-25T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MySQL - 데이터 모델링</h3><div class="text-muted small"><p> 들어가기 전 애플리케이션을 설계할 때 ‘DB 테이블은 어떻게 구성해야하지?’ 에 대한 막막함이 있다면 데이터 모델링이 문제 해결의 출발점이라고 생각한다. 공부를 하기에 앞서 나의 언어로 정리해본다면 내가 생각하기에 모델링이라는 것은 먼저 문자 그대로 ‘모델화’ 시킨다는 것인데, 모델이란 ‘어떤 대상을 필요한 특징만 추려서 나타낸 것’ 이라는 생...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cyrillic-alphabet-issue/" class="btn btn-outline-primary" prompt="Older"><p>키릴문자를 아시나요 ?</p></a> <a href="/posts/how-mybatis-spring-transaction-works/" class="btn btn-outline-primary" prompt="Newer"><p>MyBatis-Spring 트랜잭션 관리</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/username">Lee JaeYoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zz9z9.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
