<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="카프카 전달보증 구현하기 - Exactly Once" /><meta property="og:locale" content="en_US" /><meta name="description" content="Exactly Once 메시지 유실없이 정확히 한 번 전달한다 ?? –&gt; 전달보다는 ‘브로커에서’ 정확히 한번만 ‘처리된다’라는게 맞는거같다 -&gt; 근데 컨슈머측에서 처리하다 에러나면, 재송신하는거 아닌가 ? -&gt; 즉, at least once랑 같은데 메시지 중복처리만 안되게하는거 아닌가 ??v -&gt; 아닌거 같다, 만약 브로커에서 프로듀서로부터 받은 메시지 저장했는데 ack를 다시 프로듀서로 못 보내서 프로듀서에서 재송신오는 경우, transaction id 통해 메시지 중복처리 방지해줄거같다. -&gt; 따라서, 컨슈머측에서는 중복된 메시지를 consume 하는 일은 없는것 ??" /><meta property="og:description" content="Exactly Once 메시지 유실없이 정확히 한 번 전달한다 ?? –&gt; 전달보다는 ‘브로커에서’ 정확히 한번만 ‘처리된다’라는게 맞는거같다 -&gt; 근데 컨슈머측에서 처리하다 에러나면, 재송신하는거 아닌가 ? -&gt; 즉, at least once랑 같은데 메시지 중복처리만 안되게하는거 아닌가 ??v -&gt; 아닌거 같다, 만약 브로커에서 프로듀서로부터 받은 메시지 저장했는데 ack를 다시 프로듀서로 못 보내서 프로듀서에서 재송신오는 경우, transaction id 통해 메시지 중복처리 방지해줄거같다. -&gt; 따라서, 컨슈머측에서는 중복된 메시지를 consume 하는 일은 없는것 ??" /><link rel="canonical" href="https://zz9z9.github.io/posts/kafka-delivery-guarantees-exactly-once/" /><meta property="og:url" content="https://zz9z9.github.io/posts/kafka-delivery-guarantees-exactly-once/" /><meta property="og:site_name" content="zz9z9" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-29T14:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="카프카 전달보증 구현하기 - Exactly Once" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-09T14:44:11+09:00","datePublished":"2021-07-29T14:00:00+09:00","description":"Exactly Once 메시지 유실없이 정확히 한 번 전달한다 ?? –&gt; 전달보다는 ‘브로커에서’ 정확히 한번만 ‘처리된다’라는게 맞는거같다 -&gt; 근데 컨슈머측에서 처리하다 에러나면, 재송신하는거 아닌가 ? -&gt; 즉, at least once랑 같은데 메시지 중복처리만 안되게하는거 아닌가 ??v -&gt; 아닌거 같다, 만약 브로커에서 프로듀서로부터 받은 메시지 저장했는데 ack를 다시 프로듀서로 못 보내서 프로듀서에서 재송신오는 경우, transaction id 통해 메시지 중복처리 방지해줄거같다. -&gt; 따라서, 컨슈머측에서는 중복된 메시지를 consume 하는 일은 없는것 ??","headline":"카프카 전달보증 구현하기 - Exactly Once","mainEntityOfPage":{"@type":"WebPage","@id":"https://zz9z9.github.io/posts/kafka-delivery-guarantees-exactly-once/"},"url":"https://zz9z9.github.io/posts/kafka-delivery-guarantees-exactly-once/"}</script><title>카프카 전달보증 구현하기 - Exactly Once | zz9z9</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zz9z9"><meta name="application-name" content="zz9z9"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q7PWLG5WYT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q7PWLG5WYT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Soccerball.svg/1000px-Soccerball.svg.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zz9z9</a></div><div class="site-subtitle font-italic">거창한 계획보다는, 꾸준한 실행을</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zz9z9" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>카프카 전달보증 구현하기 - Exactly Once</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>카프카 전달보증 구현하기 - Exactly Once</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lee JaeYoon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 29, 2021, 2:00 PM +0900" prep="on" > Jul 29, 2021 <i class="unloaded">2021-07-29T14:00:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Nov 9, 2024, 2:44 PM +0900" prefix="Updated " > Nov 9, 2024 <i class="unloaded">2024-11-09T14:44:11+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2280 words">12 min</span></div></div><div class="post-content"><h1 id="exactly-once">Exactly Once</h1><hr /><ul><li>메시지 유실없이 정확히 한 번 전달한다 ?? –&gt; 전달보다는 ‘브로커에서’ 정확히 한번만 ‘처리된다’라는게 맞는거같다 -&gt; 근데 컨슈머측에서 처리하다 에러나면, 재송신하는거 아닌가 ? -&gt; 즉, at least once랑 같은데 메시지 중복처리만 안되게하는거 아닌가 ??v -&gt; 아닌거 같다, 만약 브로커에서 프로듀서로부터 받은 메시지 저장했는데 ack를 다시 프로듀서로 못 보내서 프로듀서에서 재송신오는 경우, transaction id 통해 메시지 중복처리 방지해줄거같다. -&gt; 따라서, 컨슈머측에서는 중복된 메시지를 consume 하는 일은 없는것 ??</ul><blockquote><p>카프카는 초기에 <code class="language-plaintext highlighter-rouge">at-most-once</code>와 <code class="language-plaintext highlighter-rouge">at-least-once</code> 수준의 전달 보증만 지원했었다. <br /> 하지만, 카프카의 유용성이 높아지면서 Exactly Once 수준의 전달을 보증하고자 하는 요구가 높아졌다. <br /> 이를 위해 카프카에 <strong><em>트랜잭션</em></strong> 개념이 도입되었다. <code class="language-plaintext highlighter-rouge">exactly-once</code> 전달 보증은 0.11 버전부터(Released June 28, 2017, <a href="https://kafka.apache.org/downloads">참고</a> ) <code class="language-plaintext highlighter-rouge">idempotent</code>와 <code class="language-plaintext highlighter-rouge">transactional producers</code> 두 가지 옵션을 통해 지원한다. 결과적으로 메시지는 한 번만 전달되며 유실되지 않는다.</p></blockquote><ul><li><p>exactly-once delivery는 프로듀서부터 컨슈머까지 연결되는 파이프라인의 처리를 뜻합니다. 기존 프로듀서의 경우 트랜잭션처리를 하지 않으면 카프카 클러스터에 두번이상 데이터가 저장될 수 있습니다. 데이터가 클러스터에 저장되었으나 ack가 유실되어 프로듀서가 재처리하는 경우가 대표적입니다. 결과적으로 카프카 트랜잭션 처리를 하더라도 컨슈머가 중복해서 데이터 처리하는 것에 대해 보장하지 않으므로, <strong><em>컨슈머의 중복처리는 따로 로직을 작성해야합니다.</em></strong></p><li><code class="language-plaintext highlighter-rouge">enable.idempotence</code>를 true로 하게 되면 카프카는 중복 메시지 제거 알고리즘에서 <code class="language-plaintext highlighter-rouge">transactional.id</code>를 사용하여 프로듀서가 보내는 모든 메시지의 멱등성(idempotence)을 보장한다.<ul><li>간단히 말해, 프로듀서가 같은 메시지를 두 번 이상 송신하게 되면, Kafka는 이러한 설정을 통해 알아차릴 수 있다.<li>프로듀서마다 트랜잭션 ID는 구별되어야 한다.</ul><li><code class="language-plaintext highlighter-rouge">at-most-once</code>와 <code class="language-plaintext highlighter-rouge">at-least-once</code> 수준의 전달 보증에 비해 처리량이 낮고(lower throughput) 대기 시간이 더 길 수 있다(higher latency).</ul><h2 id="구현하기">구현하기</h2><ul><li>To work with the transaction API, we’ll need Kafka’s Java client</ul><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.kafka<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>kafka-clients<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

</pre></table></code></div></div><h3 id="1-프로듀서">1. 프로듀서</h3><p>-</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>producerProps.put("enable.idempotence", "true");
producerProps.put("transactional.id", "prod-1");
producerProps.put("acks", "all");

 max.in.flight.requests.per.connection ???
</pre></table></code></div></div><p>enable.idempotence When set to ‘true’, the producer will ensure that exactly one copy of each message is written in the stream. If ‘false’, producer retries due to broker failures, etc., may write duplicates of the retried message in the stream. Note that enabling idempotence requires max.in.flight.requests.per.connection to be less than or equal to 5, retries to be greater than 0 and acks must be ‘all’.</p><p>If these values are not explicitly set by the user, suitable values will be chosen. If incompatible values are set, a ConfigException will be thrown. -&gt; https://docs.confluent.io/platform/current/installation/configuration/producer-configs.html</p><ol><li>프로듀서 준비<ul><li><code class="language-plaintext highlighter-rouge">producer.initTransactions();</code><li>트랜잭션을 사용하는 프로듀서로 브로커에 등록된다.<li>프로듀서는 transactional.id와 시퀀스 번호 또는 에포크(epoch)로 식별된다.<li>브로커는 이를 사용하여 트랜잭션 로그에 모든 작업을 미리 기록한다.<li>결과적으로 브로커는 동일한 트랜잭션 ID와 이전 에포크를 가진 프로듀서에 속하는 모든 작업을 해당 로그에서 제거하고, 이러한 작업이 존재하지 않는 트랜잭션에서 발생한 것으로 가정한다. (??)</ul><li>???<ul><li><code class="language-plaintext highlighter-rouge">producer.beginTransaction();</code> ???<li>메시지는 파티셔닝 될 수 있기 때문에, 트랜잭션 메시지가 여러 파티션에 걸쳐 있고 각 파티션마다 별도의 컨슈머가 메시지를 읽는다.<li>따라서 Kafka는 트랜잭션에 대해 업데이트된 모든 파티션 목록을 저장한다.<li>트랜잭션 내에서 프로듀서는 멀티 스레드를 사용하여 레코드를 병렬로 전송할 수 있다.</ul></ol><h3 id="2-브로커">2. 브로커</h3><ul><li><code class="language-plaintext highlighter-rouge">min.insync.replicas</code> -&gt; When a producer sets acks to “all” (or “-1”), min.insync.replicas specifies the minimum number of replicas that must acknowledge a write for the write to be considered successful. If this minimum cannot be met, then the producer will raise an exception (either NotEnoughReplicas or NotEnoughReplicasAfterAppend). When used together, min.insync.replicas and acks allow you to enforce greater durability guarantees. A typical scenario would be to create a topic with a replication factor of 3, set min.insync.replicas to 2, and produce with acks of “all”. This will ensure that the producer raises an exception if a majority of replicas do not receive a write.</ul><h3 id="3-consumer">3. Consumer</h3><ul><li><code class="language-plaintext highlighter-rouge">isolation.level</code>을 사용하여 연관된 트랜잭션이 커밋될 때까지 트랜잭션 메시지를 기다릴 수 있다.<ul><li><code class="language-plaintext highlighter-rouge">read_committed</code> : 트랜잭션이 완료되기 전까지 트랜잭션 메시지를 읽지 않는다. (default 값)<li><code class="language-plaintext highlighter-rouge">read_uncommitted</code> : 아직 커밋되지 않은 메시지뿐 아니라 트랜잭션이 abort된 메시지도 읽는다. (즉 모든 메시지를 읽는다)<li>트랜잭션과 무관한 메시지는 isolation.level과 상관없이 모든 경우에 읽을 수 있다.<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>consumerProps.put("enable.auto.commit", "false");
consumerProps.put("isolation.level", "read_committed");
</pre></table></code></div></div></ul></ul><ol><li>마지막으로 방금 소비한 오프셋을 적용해야 합니다. 트랜잭션을 사용하면 오프셋을 정상적으로 읽은 입력 항목에 다시 적용합니다. 또한, 우리는 생산자의 거래에 그것들을 보냅니다.</ol><h2 id="테스트-시나리오">테스트 시나리오</h2><ul><li><code class="language-plaintext highlighter-rouge">enable.idempotence</code>를 true로 하게 되면 카프카는 중복 메시지 제거 알고리즘에서 <code class="language-plaintext highlighter-rouge">transactional.id</code>를 사용하여 프로듀서가 보내는 모든 메시지의 멱등성(idempotence)을 보장한다. -&gt; 어케 테스트하지 ???</ul><ol><li>producer.sendOffsetsToTransaction(offsetsToCommit, CONSUMER_GROUP_ID); 없으면 오프셋 변동 없을지 2.</ol><h2 id="테스트-결과">테스트 결과</h2><ul><li>정확히 한번만 전달되어야됨<li>메시지 중복 없어야됨</ul><h2 id="전체-코드">전체 코드</h2><p>#</p><p>트랜잭션 처리를 위한 STATE 같은게 있나 ??</p><h1 id="실제-운영환경-">실제 운영환경 ?</h1><hr /><ul><li><p>acks=1이라고 해서 메시지 손실률이 전혀 없는 것은 아닙니다. 하지만 방금 설명드린 현상이 빈번하게 일어나는 일은 아니고, 메시지를 보내는 속도 역시 고려사항중 하나이기 때문에 실제 운영환경에서는 acks=1로 가장 많이 사용하고 있습니다. 제가 운영하는 카프카에서도 프로듀서 옵션은 acks=1을 가장 많이 사용하고 있습니다. 이어서 마지막 옵션에 대해 살펴보겠습니다.</p><li><p>실제 운영환경에서 브로커 노드 2개가 동시에 다운되는 일은 거의 발생하지 않습니다. 그래서 Replication Factor를 3으로 운영하시고, 안정적인 구현을 위해서는 min.insync.replicas는 2로 설정하는 것이 가장 바람직하다고 생각됩니다.</p><li><p>제가 설명드린 여러 예제중 가장 안정적인 예제로 acks=all, Replication Factor=3과 min.insync.replicas=2로 설명드렸지만, 실제 운영환경에서 가장 많이 쓰이는 옵션은 아닙니다. 운영환경에서 가장 많이 쓰이는 옵션은 프로듀서의 acks=all보다는 acks=1를 가장 많이 사용하고 있습니다. 그래서 저는 운영하면서 브로커의 min.insync.replicas옵션에 대해 크게 신경쓰지 않았습니다. 하지만 앞으로 추가되는 메시지의 중요도에 따라 해당 옵션들을 변경하여 사용할 수 있기 때문에 해당 옵션들에 대해 완벽하게 이해하시고 본인의 운영환경을 파악한 후 그에 알맞은 설정을 하는 것이 가장 중요하다고 생각합니다.</p><li><p>우리회사는 ??</p></ul><h1>???</h1><hr /><p>Invalid transition attempted from state READY to state ABORTING_TRANSACTION consumer.commitInSync랑 차이 ?? TransactionalId prod-0: Invalid transition attempted from state READY to state ABORTING_TRANSACTION</p><ul><li>전달보증은 메시지를 보내는 횟수와 관련이 있는거고, 메시지 유실과 관련된건 acks와 replication ??<li>상호 보완적인것 ??<li><p>at least once를 구현하려면 acks가 필요하다 ??</p><li><p>★ 프로듀서에서의 전달 보증은 acks를 통해 구현할 수 있다 ! -&gt; acks가 0이면 at most once -&gt; acks가 1이면 at least once -&gt; acks가 all이면 exactly once ?? (all이라는건 min.insync.replica에 정의된 최소 ISR 수, min.insync.replicas 옵션은 브로커의 옵션이다 - config/server.properties) -&gt; all 이여도 -&gt; acks가 all이어도 at least once 될 수 있지 않나 ???</p><li>전달보증이라는건 브로커 -&gt; 컨슈머로의 전달을 의미 ?? -&gt;</ul><h1 id="참고자료">참고자료</h1><hr /><ul><li>https://www.baeldung.com/kafka-exactly-once<li>https://supergloo.com/kafka/kafka-architecture-delivery/<li>https://blog.voidmainvoid.net/354<li>https://dzone.com/articles/kafka-producer-delivery-semantics<li>https://gunju-ko.github.io/kafka/2019/01/07/%EC%B9%B4%ED%94%84%EC%B9%B4%EC%BB%A8%EC%8A%88%EB%A8%B8.html<li>https://www.popit.kr/kafka-%EC%9A%B4%EC%98%81%EC%9E%90%EA%B0%80-%EB%A7%90%ED%95%98%EB%8A%94-producer-acks/</ul></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=카프카 전달보증 구현하기 - Exactly Once - zz9z9&url=https://zz9z9.github.io/posts/kafka-delivery-guarantees-exactly-once/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=카프카 전달보증 구현하기 - Exactly Once - zz9z9&u=https://zz9z9.github.io/posts/kafka-delivery-guarantees-exactly-once/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=카프카 전달보증 구현하기 - Exactly Once - zz9z9&url=https://zz9z9.github.io/posts/kafka-delivery-guarantees-exactly-once/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-entity-manager-persistence-context/">EntityManager와 영속성 컨텍스트</a><li><a href="/posts/jpa-id-generation-strategy/">JPA/Hibernate ID 생성 전략</a><li><a href="/posts/aws-vpc/">AWS VPC(Virtual Private Cloud) - 기초 개념</a><li><a href="/posts/aws-efs/">AWS EFS(Elastic File System) - 기초 개념</a><li><a href="/posts/aws-intro/">AWS - 상품 살펴보기</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cautions-when-jpa-mybatis-together/"><div class="card-body"> <span class="timeago small" > Feb 10 <i class="unloaded">2026-02-10T22:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA / MyBatis 혼용시 주의사항 (in 배치 애플리케이션)</h3><div class="text-muted small"><p> JPA와 MyBatis는 서로의 존재를 모른다. MyBatis는 JDBC를 직접 사용하므로 JPA 영속성 컨텍스트를 우회하여 DB를 변경하고, JPA는 이를 감지할 수 없다. 결과적으로 JPA 1차 캐시에는 변경 전 데이터(stale data)가 남게 되어 데이터 불일치가 발생한다. 문제 상황 예시 1. 같은 엔티티를 JPA로 읽고 ...</p></div></div></a></div><div class="card"> <a href="/posts/how-jpa-item-writer-merge-works/"><div class="card-body"> <span class="timeago small" > Jan 29 <i class="unloaded">2026-01-29T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>이슈 - JpaItemWriter로 엔티티 저장시, ChunkSize만큼 SELECT 쿼리 발생하는 상황</h3><div class="text-muted small"><p> 상황 배치 애플리케이션에서 A 테이블에서 조회 -&gt; 가공 -&gt; B 테이블에 저장 흐름으로 동작하는 청크 기반의 Job이 있음 B 테이블에 저장시 JpaItemWriter 사용 B 테이블에 저장하는 엔티티의 PK는 A 테이블의 PK와 동일. 즉, A 테이블에서 조회한 엔티티의 PK가 사용됨 (Assigned ID + @Vers...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-id-generation-strategy/"><div class="card-body"> <span class="timeago small" > Jan 29 <i class="unloaded">2026-01-29T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA/Hibernate ID 생성 전략</h3><div class="text-muted small"><p> @GeneratedValue 기본 키(primary key) 값의 생성 전략을 지정하는 데 사용 즉, 데이터베이스에 새 레코드를 삽입할 때 기본 키 값을 자동으로 생성하는 방법을 지정 @GeneratedValue는 @Id와 함께 엔티티 또는 매핑된 슈퍼클래스의 기본 키 속성이나 필드에 적용할 수 있다. @GeneratedValu...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/xssf-oom-analyze/" class="btn btn-outline-primary" prompt="Older"><p>XSSF로 인한 OOM 에러 그리고 SXSSF와 메모리 사용량 비교해보기</p></a> <a href="/posts/kafka-producer-message-retry-test/" class="btn btn-outline-primary" prompt="Newer"><p>(미해결) 카프카 프로듀서 재송신 테스트</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/username">Lee JaeYoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zz9z9.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
