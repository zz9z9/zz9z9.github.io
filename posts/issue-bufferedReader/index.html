<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상" /><meta property="og:locale" content="en_US" /><meta name="description" content="상황 ‘자바 웹 프로그래밍 NextStep’ 3장의 과제 중 하나인 웹 서버를 구현하기 위해 HTTP 요청이 서버에 어떤식으로 들어오는지를 보고싶었다. 따라서, 단순 확인을 위해 다음과 같은 코드를 작성하여 실행시키고 브라우저에서 localhost:8080 으로 요청을 보냈다. ```java public class TestServer { public void start() throws IOException { ServerSocket serverSocket = new ServerSocket(8080); Socket connection;" /><meta property="og:description" content="상황 ‘자바 웹 프로그래밍 NextStep’ 3장의 과제 중 하나인 웹 서버를 구현하기 위해 HTTP 요청이 서버에 어떤식으로 들어오는지를 보고싶었다. 따라서, 단순 확인을 위해 다음과 같은 코드를 작성하여 실행시키고 브라우저에서 localhost:8080 으로 요청을 보냈다. ```java public class TestServer { public void start() throws IOException { ServerSocket serverSocket = new ServerSocket(8080); Socket connection;" /><link rel="canonical" href="https://zz9z9.github.io/posts/issue-bufferedReader/" /><meta property="og:url" content="https://zz9z9.github.io/posts/issue-bufferedReader/" /><meta property="og:site_name" content="zz9z9" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-01T00:29:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-01T00:29:00+09:00","datePublished":"2021-06-01T00:29:00+09:00","description":"상황 ‘자바 웹 프로그래밍 NextStep’ 3장의 과제 중 하나인 웹 서버를 구현하기 위해 HTTP 요청이 서버에 어떤식으로 들어오는지를 보고싶었다. 따라서, 단순 확인을 위해 다음과 같은 코드를 작성하여 실행시키고 브라우저에서 localhost:8080 으로 요청을 보냈다. ```java public class TestServer { public void start() throws IOException { ServerSocket serverSocket = new ServerSocket(8080); Socket connection;","headline":"BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상","mainEntityOfPage":{"@type":"WebPage","@id":"https://zz9z9.github.io/posts/issue-bufferedReader/"},"url":"https://zz9z9.github.io/posts/issue-bufferedReader/"}</script><title>BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상 | zz9z9</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zz9z9"><meta name="application-name" content="zz9z9"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q7PWLG5WYT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q7PWLG5WYT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Soccerball.svg/1000px-Soccerball.svg.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zz9z9</a></div><div class="site-subtitle font-italic">거창한 계획보다는, 꾸준한 실행을</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zz9z9" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lee JaeYoon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 1, 2021, 12:29 AM +0900" prep="on" > Jun 1, 2021 <i class="unloaded">2021-06-01T00:29:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1306 words">7 min</span></div></div><div class="post-content"><h1 id="상황">상황</h1><hr /><ul><li>‘자바 웹 프로그래밍 NextStep’ 3장의 과제 중 하나인 웹 서버를 구현하기 위해 HTTP 요청이 서버에 어떤식으로 들어오는지를 보고싶었다.<li>따라서, 단순 확인을 위해 다음과 같은 코드를 작성하여 실행시키고 브라우저에서 localhost:8080 으로 요청을 보냈다.<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServer</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
      <span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
      <span class="nc">Socket</span> <span class="n">connection</span><span class="o">;</span>

      <span class="k">while</span><span class="o">((</span><span class="n">connection</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">())</span> <span class="o">!=</span><span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"[connection info]%nIpAddr : %s, Port : %s%n"</span><span class="o">,</span> <span class="n">connection</span><span class="o">.</span><span class="na">getInetAddress</span><span class="o">(),</span> <span class="n">connection</span><span class="o">.</span><span class="na">getPort</span><span class="o">()));</span>
          <span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">connection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>

          <span class="nc">String</span> <span class="n">line</span><span class="o">;</span>
          <span class="k">while</span><span class="o">((</span><span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())!=</span><span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 여기서 멈춘다</span>
              <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
          <span class="o">}</span>

          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"END!"</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
     <span class="nc">TestServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestServer</span><span class="o">();</span>
     <span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><li><p>아래와 같이 요청이 들어오는 것을 확인할 수 있었고, ‘Http Method(GET, POST, …)가 뭔지 확인하려면 요청의 첫 번째 라인을 확인하면 되겠구나’ 등의 판단을 할 수 있었다. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/64415489/125474131-fb47851c-3e78-448f-91e1-57ad8fcd5a5e.png" alt="image" /></p><li>하지만, 문제는 코드의 15번째 라인 <code class="language-plaintext highlighter-rouge">System.out.println("END!");</code> 에 대한 출력이 콘솔에 찍히지 않았다는 것이었다. 디버거로 확인해보니 무한루프를 도는 것도 아니고 위 코드의 11번째 라인에서 대기 상태가 되는 것을 확인할 수 있었다.</ul><h1 id="해결-과정">해결 과정</h1><hr /><ul><li><p><a href="https://stackoverflow.com/questions/7855822/bufferedreader-readline-method-hangs-and-block-program">스택오버플로우에 있는 글</a> 을 통해 BufferedReader의 readLine() 메서드는 라인이 종료되었다고 판단되지 않으면 값을 리턴하지 않는다는 것을 알게되었다.</p><li>그렇다면 라인이 종료되었다는 것을 판단하는 기준은 뭘까??<ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/BufferedReader.html">자바 공식문서</a> 에 나와있는 readLine() 메서드에 대한 설명을 보면 끝에 다음 문자(‘\n’, ‘\r’, ‘\r\n’) 중 하나가 있어야 하나의 라인으로 인식한다고 한다.<blockquote><p><q> Reads a line of text. A line is considered to be terminated by any one of a line feed (‘\n’), <br /> a carriage return (‘\r’), or a carriage return followed immediately by a linefeed. </q></p></blockquote></ul><li>또한, BufferedReader의 readLine() 메서드를 직접 들여다보면 다음과 같은 로직이 있는 것을 확인할 수 있다. eol은 ‘end of line’이지 않을까 싶다.<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nl">charLoop:</span>
              <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">nextChar</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nChars</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                  <span class="n">c</span> <span class="o">=</span> <span class="n">cb</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                  <span class="k">if</span> <span class="o">((</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\r'</span><span class="o">))</span> <span class="o">{</span>
                      <span class="n">eol</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                      <span class="k">break</span> <span class="n">charLoop</span><span class="o">;</span>
                  <span class="o">}</span>
              <span class="o">}</span>
</pre></table></code></div></div><li>그렇다면, HTTP 요청의 마지막 라인이 어떻길래 아직 라인이 종료되었다고 판단하지 않는걸까 ?<ul><li><a href="https://stackoverflow.com/questions/50447483/end-of-http-header">스택오버플로우에 있는 글</a><li><a href="https://datatracker.ietf.org/doc/html/rfc2616#page-35">RFC 문서 34p</a><li>HTTP 요청 형태 (HTTP 요청 헤더의 마지막 라인은 공백이었고 이로 인해 readLine() 메서드가 라인이 끝나지 않았다고 판단한 것)<br /><li>CRLF : Carriage Return(커서의 위치를 맨 앞으로 이동) + Line Feed(커서를 한 칸 아래로 이동)</ul></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>Request-Line
*(( general-header
 | request-header
 | entity-header ) CRLF)
CRLF
[ message-body ]
</pre></table></code></div></div><ul><li>결과적으로 line이 공백이면 <code class="language-plaintext highlighter-rouge">"공백"</code>이라는 문자열을 출력해봄으로써 실제 HTTP 요청이 위와 같이 들어온다는 것을 알 수 있었고, 공백인 경우 break를 통해 while문 내에서 계속 대기상태에 머물러있지 않게 할 수 있었다. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/64415489/123302221-6fd47e00-d557-11eb-9a06-0e37d4e6b4f7.png" alt="image" /></ul><p>※ 참고. HTTP Response 포맷</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>Status-Line
*(( general-header
 | response-header
 | entity-header ) CRLF)
CRLF
[ message-body ]
</pre></table></code></div></div><h1 id="요약">요약</h1><hr /><h3 id="현상">현상</h3><ul><li>HTTP 요청을 받아서 BufferedReader의 readLine() 메서드로 읽어 올 때 특정 라인에 도달하면 대기 상태에 머문다.</ul><h3 id="원인">원인</h3><ul><li>readLine() 메서드 내에는 ‘하나의 라인’이라고 판단하는 기준(라인 마지막에 ‘\n’, ‘\r’, ‘\r\n’)이 있는데, <br /> HTTP 요청의 마지막 라인은 공백이었기 때문에 아직 한 라인이 끝나지 않았다고 판단하여 계속 대기하고 있었다.</ul><h1 id="배운-것">배운 것</h1><hr /><ul><li>HTTP 요청 형태<li>BufferedReader의 readLine() 메서드가 라인을 인식하는 방법</ul><h1 id="실제-코드-적용">실제 코드 적용</h1><hr /><ul><li><a href="https://github.com/zz9z9/nextstep-web-application-server">간단한 웹 서버 구현 레파지토리</a><li>오늘 내용 관련 코드<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre>  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">HttpRequest</span> <span class="nf">processGetRequest</span><span class="o">(</span><span class="nc">String</span> <span class="n">requestUrl</span><span class="o">,</span> <span class="nc">BufferedReader</span> <span class="n">bufferedReader</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
      <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">cookies</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

      <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span> <span class="o">(</span><span class="n">line</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">line</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span> <span class="n">line</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"Cookie"</span><span class="o">))</span> <span class="o">{</span>
              <span class="nc">String</span><span class="o">[]</span> <span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">);</span>
              <span class="n">cookies</span> <span class="o">=</span> <span class="n">parseCookies</span><span class="o">(</span><span class="n">info</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
              <span class="k">break</span><span class="o">;</span>
          <span class="o">}</span>
      <span class="o">}</span>

      <span class="k">if</span> <span class="o">(!</span><span class="n">requestUrl</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"?"</span><span class="o">))</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="nf">HttpRequest</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">requestUrl</span><span class="o">,</span> <span class="n">cookies</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nc">String</span><span class="o">[]</span> <span class="n">info</span> <span class="o">=</span> <span class="n">requestUrl</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"\\?"</span><span class="o">);</span>
      <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">parseQueryString</span><span class="o">(</span><span class="n">info</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>

      <span class="k">return</span> <span class="k">new</span> <span class="nf">HttpRequest</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">info</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">params</span><span class="o">,</span> <span class="n">cookies</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">HttpRequest</span> <span class="nf">processPostRequest</span><span class="o">(</span><span class="nc">String</span> <span class="n">requestUrl</span><span class="o">,</span> <span class="nc">BufferedReader</span> <span class="n">bufferedReader</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">contentLen</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="nc">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
      <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">cookies</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

      <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span> <span class="o">(</span><span class="n">line</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">line</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span> <span class="n">line</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">))</span> <span class="o">{</span>
              <span class="nc">String</span><span class="o">[]</span> <span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">);</span>
              <span class="n">contentLen</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">info</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">());</span>
          <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">))</span> <span class="o">{</span>
              <span class="nc">String</span><span class="o">[]</span> <span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">);</span>
              <span class="n">contentType</span> <span class="o">=</span> <span class="n">info</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">();</span> <span class="c1">// ex) application/x-www-form-urlencoded</span>
          <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"Cookie"</span><span class="o">))</span> <span class="o">{</span>
              <span class="nc">String</span><span class="o">[]</span> <span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">);</span>
              <span class="n">cookies</span> <span class="o">=</span> <span class="n">parseCookies</span><span class="o">(</span><span class="n">info</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
          <span class="o">}</span>
      <span class="o">}</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">contentLen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
          <span class="kt">char</span><span class="o">[]</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">contentLen</span><span class="o">];</span>
          <span class="n">bufferedReader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>

          <span class="k">if</span> <span class="o">(</span><span class="n">contentType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"application/x-www-form-urlencoded"</span><span class="o">))</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">queryString</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
              <span class="n">params</span> <span class="o">=</span> <span class="n">parseQueryString</span><span class="o">(</span><span class="n">queryString</span><span class="o">);</span>
          <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">contentType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">))</span> <span class="o">{</span>
              <span class="c1">// TODO</span>
          <span class="o">}</span>
      <span class="o">}</span>

      <span class="k">return</span> <span class="k">new</span> <span class="nf">HttpRequest</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="n">requestUrl</span><span class="o">,</span> <span class="n">params</span><span class="o">,</span> <span class="n">cookies</span><span class="o">);</span>
  <span class="o">}</span>
</pre></table></code></div></div></ul><h1 id="더-공부해야할-부분">더 공부해야할 부분</h1><hr /><ul><li>JAVA I/O<li>HTTP 응답 분할(HTTP Response Splitting, CRLF) 취약점</ul><h1 id="참고자료">참고자료</h1><hr /><ul><li><a href="https://stackoverflow.com/questions/7855822/bufferedreader-readline-method-hangs-and-block-program">https://stackoverflow.com/questions/7855822/bufferedreader-readline-method-hangs-and-block-program</a><li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/BufferedReader.html">https://docs.oracle.com/javase/8/docs/api/java/io/BufferedReader.html</a><li><a href="https://stackoverflow.com/questions/50447483/end-of-http-header">https://stackoverflow.com/questions/50447483/end-of-http-header</a><li><a href="https://datatracker.ietf.org/doc/html/rfc2616">https://datatracker.ietf.org/doc/html/rfc2616</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EA%B2%BD%ED%97%98%ED%95%98%EA%B8%B0/'>경험하기</a>, <a href='/categories/%EC%9D%B4%EC%8A%88-%EB%85%B8%ED%8A%B8/'>이슈 노트</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java-i-o/" class="post-tag no-text-decoration" >JAVA I/O</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상 - zz9z9&url=https://zz9z9.github.io/posts/issue-bufferedReader/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상 - zz9z9&u=https://zz9z9.github.io/posts/issue-bufferedReader/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=BufferedReader의 readLine() 메서드 이후의 코드로 진행이 안되는 현상 - zz9z9&url=https://zz9z9.github.io/posts/issue-bufferedReader/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-entity-manager-persistence-context/">EntityManager와 영속성 컨텍스트</a><li><a href="/posts/jpa-id-generation-strategy/">JPA/Hibernate ID 생성 전략</a><li><a href="/posts/aws-vpc/">AWS VPC(Virtual Private Cloud) - 기초 개념</a><li><a href="/posts/aws-efs/">AWS EFS(Elastic File System) - 기초 개념</a><li><a href="/posts/aws-intro/">AWS - 상품 살펴보기</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/try-with-resource-caution/"><div class="card-body"> <span class="timeago small" > Sep 5, 2021 <i class="unloaded">2021-09-05T14:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>try-with-resource 사용시 Socket closed 예외 발생</h3><div class="text-muted small"><p> 상황 자바로 만든 간단한 웹 서버에서 404, 500과 같은 에러 페이지 처리를 위해 catch 절 내부에 에러 페이지를 응답하는 로직을 작성했다. 하지만 에러 발생시 에러 페이지가 응답되지 않고 java.net.SocketException: Socket closed가 발생했다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 publi...</p></div></div></a></div><div class="card"> <a href="/posts/ie-doesnt-support-issue/"><div class="card-body"> <span class="timeago small" > Dec 6, 2021 <i class="unloaded">2021-12-06T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IE에서 작동하지 않는 자바스크립트 코드</h3><div class="text-muted small"><p> 상황 회사에서 맡은 작업을 로컬 환경에서 개발/테스트하고 개발 환경에 배포하여 잘 동작하는지 테스트해봤다. 로컬에서 여러 번의 테스트 결과 별이상 없었기 때문에 당연히 되겠지하고 ‘조회’ 버튼을 누르는데 아무런 반응이 없었다… IE 개발자 도구를 통해 콘솔을 확인해보니, 서버에서 응답받은 js 파일 중 하나에서 SCRIPT1004: ';'가 필요합...</p></div></div></a></div><div class="card"> <a href="/posts/maven-http-block-issue/"><div class="card-body"> <span class="timeago small" > Dec 8, 2021 <i class="unloaded">2021-12-08T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>maven-default-http-blocker ... Blocked mirror for repositories 에러</h3><div class="text-muted small"><p> 상황 회사에서 지급받은 임시 PC를 2주 정도 사용하고, 앞으로 계속 사용하게될 새로운 PC를 지급받아 개발 환경을 다시 세팅하고 있었다. 하지만, 세팅하는 프로젝트에서 의존성을 제대로 다운로드 받지 못하고 다음과 같은 에러 메시지를 출력했다. Could not transfer artifact ... from/to maven-default-http...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cookie-not-setting/" class="btn btn-outline-primary" prompt="Older"><p>화면 리디렉션시 쿠키 송신이 안되는 현상</p></a> <a href="/posts/spa-vs-mpa/" class="btn btn-outline-primary" prompt="Newer"><p>Multi Page Application vs Single Page Application</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/username">Lee JaeYoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zz9z9.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
