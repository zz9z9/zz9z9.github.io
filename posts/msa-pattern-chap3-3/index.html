<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="마이크로서비스간 통신(3) - 비동기 방식" /><meta property="og:locale" content="en_US" /><meta name="description" content="※ 해당 내용은 ‘마이크로서비스 패턴(크리스 리처드슨)’ 3장을 읽고 정리한 내용입니다." /><meta property="og:description" content="※ 해당 내용은 ‘마이크로서비스 패턴(크리스 리처드슨)’ 3장을 읽고 정리한 내용입니다." /><link rel="canonical" href="https://zz9z9.github.io/posts/msa-pattern-chap3-3/" /><meta property="og:url" content="https://zz9z9.github.io/posts/msa-pattern-chap3-3/" /><meta property="og:site_name" content="zz9z9" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-14T22:25:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="마이크로서비스간 통신(3) - 비동기 방식" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-09T14:44:11+09:00","datePublished":"2021-06-14T22:25:00+09:00","description":"※ 해당 내용은 ‘마이크로서비스 패턴(크리스 리처드슨)’ 3장을 읽고 정리한 내용입니다.","headline":"마이크로서비스간 통신(3) - 비동기 방식","mainEntityOfPage":{"@type":"WebPage","@id":"https://zz9z9.github.io/posts/msa-pattern-chap3-3/"},"url":"https://zz9z9.github.io/posts/msa-pattern-chap3-3/"}</script><title>마이크로서비스간 통신(3) - 비동기 방식 | zz9z9</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zz9z9"><meta name="application-name" content="zz9z9"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q7PWLG5WYT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q7PWLG5WYT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Soccerball.svg/1000px-Soccerball.svg.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zz9z9</a></div><div class="site-subtitle font-italic">거창한 계획보다는, 꾸준한 실행을</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zz9z9" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>마이크로서비스간 통신(3) - 비동기 방식</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>마이크로서비스간 통신(3) - 비동기 방식</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lee JaeYoon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jun 14, 2021, 10:25 PM +0900" prep="on" > Jun 14, 2021 <i class="unloaded">2021-06-14T22:25:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Nov 9, 2024, 2:44 PM +0900" prefix="Updated " > Nov 9, 2024 <i class="unloaded">2024-11-09T14:44:11+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3967 words">22 min</span></div></div><div class="post-content"><p><em>※ 해당 내용은 ‘마이크로서비스 패턴(크리스 리처드슨)’ 3장을 읽고 정리한 내용입니다.</em></p><h1 id="비동기-메시징-패턴-응용-통신">비동기 메시징 패턴 응용 통신</h1><hr /><blockquote><p>메시징은 서비스가 메시지를 비동기적으로 주고받는 통신 방식으로서 메시지 브로커를 사용할 수도 있고 서비스간 직접 통신을 할 수도 있다. 비동기 통신이기 때문에 클라이언트가 응답을 기다리며 블로킹하지 않고 클라이언트는 응답을 바로 받지 못할 것이라는 전제하에 작성한다.</p></blockquote><h2 id="1-메시지와-채널">1. 메시지와 채널</h2><blockquote><p>메시지는 메시지 채널을 통해 교환된다. 송신자가 채널에 메시지를 쓰면 수신자는 채널에서 메시지를 읽는다.</p></blockquote><ul><li>메시지<ul><li>헤더와 바디(본문)으로 구성<li>헤더에는 송신된 데이터에 관한 메타데이터, 메시지ID, 반환주소 등이 포함<li>본문은 실제로 송신할 데이터 텍스틑 또는 이진 포맷의 데이터<li>메시지의 종류는 문서, 커맨드, 이벤트 등으로 다양</ul><li>메시지 채널<ul><li>채널은 점대점 채널, 발행-구독 채널 두 종류가 있다.<li>점대점 채널<ul><li>채널을 읽는 컨슈머 중 딱 하나만 지정해서 메시지 전달<li>일대일 통신 방식의 서비스가 이 채널을 사용 (ex : 커맨드 메시지)</ul><li>발행-구독 채널<ul><li>같은 채널을 바라모는 모든 컨슈머에 메시지 전달<li>일대다 통신 방식의 서비스가 이 채널을 사용 (ex : 이벤트 메시지)</ul></ul><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/128.jpg" height="50%" width="70%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/03/01/02/</figcaption></figure></ul><h2 id="2-메시지-상호-작용-스타일">2. 메시지 상호 작용 스타일</h2><blockquote><p>스타일에 따라 메시징으로 직접 구현 가능한 것, 메시징을 토대로 구현해야 하는 것도 있다.</p></blockquote><h3 id="요청응답-및-비동기-요청응답">요청/응답 및 비동기 요청/응답</h3><ul><li>클라이언트는 수행할 작업과 매개변수가 담긴 커맨드 메시지를 서비스가 소유한 점대점 메시징 채널로 송신<li>서비스는 요청 처리 후 응답 메시지를 클라이언트가 소유한 점대점 메시징 채널로 송신<li>요청 메시지와 응답 메시지는 짝이 맞아야 하는데, 이는 MessageId와 CorrelationId를 통해 맞춰볼 수 있다.<li>메시징으로 통신하는 클라이언트/서비스 간 상호작용은 비동기적이다.<li><p>이론적으로 클라이언트가 응답 수신시까지 블로킹할 수는 있지만, 실제로 클라이언트는 응답을 비동기 처리 하고 클라이언트 인스턴스 중 하나가 응답을 처리</p><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/129.jpg" height="50%" width="90%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/03/02/01/</figcaption></figure></ul><h3 id="단방향-알림">단방향 알림</h3><ul><li>서비스가 소유한 점대점 채널로 메시지를 보내면, 서비스는 이 채널을 구독해서 메시지 처리<li>서비스는 응답을 반환하지 않는다.</ul><h3 id="발행구독">발행/구독</h3><ul><li>클라이언트는 여러 컨슈머가 읽는 발행/구독 채널에 메시지를 발행하고, 서비스는 도메인 객체의 변경 사실을 알리는 도메인 이벤트를 발행<li>도메인 이벤트를 발행한 서비스는 해당 도메인 클래스의 이름을 딴 발행/구독 채널을 소유 <br /> (ex : 주문 서비스는 Order 이벤트를 Order 채널에 발행)<li>서비스는 자신이 관심 있는 도메인 객체의 이벤트 채널을 구독</ul><h3 id="발행비동기-응답">발행/비동기 응답</h3><ul><li>발행/구독과 요청/응답 방식을 조합<li>클라이언트는 응답 채널 헤더가 명시된 메시지를 발행/구독 채널에 발행하고, 컨슈머는 CorrelationId가 포함된 응답 메시지를 지정된 응답 채널에 송신<li>클라이언트는 CorrelationId로 응답을 취합하여 응답 메시지와 요청을 맞추어본다</ul><h2 id="3-메시지-브로커">3. 메시지 브로커</h2><blockquote><p>메시지 브로커는 서비스가 서로 통신할 수 있게 해주는 인프라 서비스로서, 메시징 기반의 애플리케이션은 대부분 메시지 브로커를 사용한다. 서비스가 서로 직접 통신하는 브로커리스 기반의 메시지 아키텍처도 있지만 일반적으로 브로커 기반의 아키텍처가 갖는 이점이 크다.</p></blockquote><h3 id="브로커리스-아키텍처">브로커리스 아키텍처</h3><ul><li>서비스간 메시지를 직접 교환<li>대표적인 브로커리스 메시징 기술로는 ZeroMQ가 있다.<li>장점<ul><li>서비스간 직접 전달되므로 네트워크 트래픽이 가볍고 지연 시간이 짧다.<li>메시지 브로커가 성능 병목점이나 SPOF(Single Poing Of Failure, 단일 장애점)이 될 일이 없다.<li>브로커가 없기 때문에 관리 포인트가 적어진다.</ul><li>단점<ul><li>서비스가 서로의 위치를 알고 있어야 하므로 서비스 디스커버리 매커니즘을 사용해야 한다.<li>송/수신자 모두 실행 중이어야 하므로 가용성이 떨어진다.<li>전달 보장(delivery-guarantee) 같은 매커니즘을 구현하기 어렵다.</ul></ul><h3 id="브로커-기반-메시징-개요">브로커 기반 메시징 개요</h3><ul><li>대표적인 메시지 브로커로서 ActiveMQ, RabbitMQ, 아파치 카프카가 있다.<li>AWS 키네시스, AWS SQS와 같은 클라우드 기반의 메시징 서비스도 있다.<li>장점<ul><li>느슨한 결합<ul><li>클라이언트는 서비스 인스턴스를 몰라도 되기 때문에 서비스 디스커버리 매커니즘도 필요 없다.</ul><li>메시지 버퍼링<ul><li>메시지 브로커는 컨슈머가 메시지를 처리할 수 있을 때까지 큐에 메시지를 보관하므로 가용성이 높아진다.</ul><li>다양한 통신 방식을 지원</ul><li>단점<ul><li>성능 병목 가능성<ul><li>메시지 브로커가 성능 병목점이 될 가능성이 있다.(따라서, 확장성이 좋아야한다)</ul><li>단일 장애점 가능성<ul><li>SPOF가 될 수 있기 때문에 가용성이 높아야한다.</ul><li>운영 복잡도 부가</ul><li>브로커별로 특징이 있다.<ul><li>어떤 브로커는 지연 시간이 매우 짧지만 메시지 순서 유지 및 전달 보장이 안된다거나, 메시지를 메모리에만 저장한다.<li>어떤 브로커는 지연 시간은 길지만, 메시지 전달을 보장하고 디스크에 저장한다.</ul><li>따라서, 애플리케이션 요건에 따라 적합한 브로커를 선택해야 한다.</ul><h3 id="메시지-브로커로-메시지-채널-구현">메시지 브로커로 메시지 채널 구현</h3><blockquote><p>메시지 채널은 브로커마다 구현 방식이 조금씩 다르다.</p></blockquote><div class="table-wrapper"><table><thead><tr><th>메시지 브로커<th>점대점 채널<th>발행-구독 채널<tbody><tr><td>JMS<td>큐<td>토픽<tr><td>아파치 카프카<td>토픽<td>토픽<tr><td>RabbitMQ(AMQP 브로커)<td>익스체인지+큐<td>팬아웃 익스체인지, 컨슈머 개별 큐<tr><td>AWS 키네시스<td>스트림<td>스트림<tr><td>AWS SQS<td>큐<td>-</table></div><h2 id="4-수신자-경합과-메시지-순서-유지">4. 수신자 경합과 메시지 순서 유지</h2><blockquote><p>예를 들어, 동일한 점대점 채널을 읽는 서비스 인스턴스가 3개 있고, 송신자는 주문 생성 → 변경 → 취소 이벤트 메시지를 차례로 전송한다고 가정해보자. 만약 네트워크 이슈, 가비지 컬렉션 문제 등으로 지연이 발생하고 메시지 처리 순서가 어긋난다면, 주문을 생성하기도 전에 취소 처리를 해야하는 상황이 벌어질 수도 있다. 따라서, 메시지를 동시 처리하는 경우 각 메시지를 정확히 한 번만 순서대로 처리하는 것이 보장되어야 한다.</p></blockquote><h3 id="샤딩된파티셔닝된-채널-이용해서-메시지-처리-순서-보장하기">샤딩된(파티셔닝된) 채널 이용해서 메시지 처리 순서 보장하기</h3><ul><li>샤딩된 채널은 복수의 샤드로 구성되며, 각 샤드는 채널처럼 작동<li>송신자는 메시지 헤더에 샤드 키를 지정하고, 메시지 브로커는 샤드 키별로 샤드/파티션에 메시지를 배정<li>메시지 브로커는 여러 수신자 인스턴스를 묶어 마치 동일한 수신자인 것처럼 취급한다(카프카에선 ‘컨슈머 그룹’)<li>메시지 브로커는 각 샤드를 하나의 수신자에 배정하고, 수신자가 시동/종료하면 샤드를 재배정한다.<li><p>아래 그림에서 같은 주문에 대한 이벤트(주문 생성, 변경, 취소 등)는 동일한 샤드에 발행될 것이고(샤드 키인 orderId가 같으므로) 샤드는 하나의 수신자 인스턴스에 배정되기 때문에 메시지 처리 순서가 보장된다.</p><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/137.jpg" height="50%" width="90%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/03/05-01/</figcaption></figure></ul><h2 id="5-중복-메시지-처리">5. 중복 메시지 처리</h2><blockquote><p>시스템이 정상일 때 ‘적어도 한 번 전달’을 보장하는 메시지 브로커는 각 메시지를 한 번만 전달한다. 그러나 클라이언트나 네트워크 또는 브로커 자신이 실패할 경우, 같은 메시지를 여러번 전달할 수도 있다. 단적인 예로, 주문 생성 → 취소 이벤트를 발행했는데 문제가 생겨 생성 이벤트만 재전송하게 되면, 결국 주문이 접수되는 문제가 생길 수 있다.</p></blockquote><h3 id="멱등한-로직-작성">멱등한 로직 작성</h3><blockquote><p>멱등하다 : 동일한 입력 값을 반복 호출해도 결과가 달라지지 않는다 (ex : 주문 취소)</p></blockquote><ul><li>메시지 재전송시 순서를 유지하다는 전제하에 멱등한 메시지 로직은 여러 번 호출되도 별 문제가 없다.<li>하지만 실제로 이렇게 멱등한 애플리케이션 로직은 많지 않다.</ul><h3 id="메시지-추적과-중복-메시지-솎아-내기">메시지 추적과 중복 메시지 솎아 내기</h3><blockquote><p>예를 들어, 신용카드 결제 승인과 같은 로직은 여러번 호출되면 심각한 문제를 발생시킬 수 있다. <br /> 따라서 중복 메시지를 솎아 내는 메시지 핸들러가 필요하다.</p></blockquote><ul><li>하나의 방법으로 컨슈머가 소비하는 메시지 ID를 DB 테이블에 저장하여 메시지 ID를 이용하여 메시지 처리 여부를 추적하면서 중복 메시지를 알아낸다.<li>즉, 컨슈머는 메시지를 처리할 때 비즈니스 엔터티를 생성/수정하는 트랜잭션의 일부로 메시지 ID를 DB 테이블에 기록한다.</ul><h2 id="6-트랜잭셔널-메시징">6. 트랜잭셔널 메시징</h2><blockquote><p>DB 업데이트와 메시지 전송을 한 트랜잭션으로 묶지 않으면, DB 업데이트 후 메시지는 아직 전송되지 않은 상태에서 서비스가 중단될 수 있다. 이 두 작업이 서비스에서 원자적으로 수행되지 않으면, 실패할 경우 시스템은 매우 불안정한 상태가 될 수 있다. 애플리케이션에서 메시지를 확실하게 발행하려면 어떻게 해야할까 ?</p></blockquote><h3 id="db-테이블을-메시지-큐로-활용">DB 테이블을 메시지 큐로 활용</h3><ul><li>RDBMS 기반의 애플리케이션의 경우 DB 테이블을 임시 메시지 큐로 사용할 수 있다.(트랜잭셔널 아웃 박스 패턴)<li>로컬 ACID 트랜잭션이기 때문에 원자성은 자동으로 보장된다.<li><p>NoSQL DB인 경우에는 DB에 레코드로 적재된 비즈니스 엔터티에 발행할 메시지 목록을 가리키는 속성에 DB 엔터티 업데이트시 메시지를 덧붙인다.</p><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/140.jpg" height="50%" width="90%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/03/07/01/</figcaption></figure></ul><h3 id="이벤트-발행--폴링-발행기-패턴">이벤트 발행 : 폴링 발행기 패턴</h3><ul><li>메시지 릴레이로 테이블을 폴링해서 미발행 메시지를 조회<li>메시지 릴레이는 조회한 메시지를 하니씩 각자의 목적지 채널로 보내서 메시지 브로커에 발행하고 OUTBOX 테이블에서 메시지 삭제<li>DB 폴링은 규모가 작은 경우 적합하고, 자주 하는 경우 비용이 유발된다.</ul><h3 id="이벤트-발행--트랜잭션-로그-테일링-패턴">이벤트 발행 : 트랜잭션 로그 테일링 패턴</h3><ul><li>메시지 릴레이로 DB 트랜잭션 로그(커밋 로그)를 테일링한다.<li>트랜잭션 로그 마이너로 로그를 읽어 변경분을 하나씩 메시지로 브로커에게 발행<li>트랜잭션 로그 마이너는 로그 항목을 읽고, 삽입된 메시지에 대응되는 각 로그 항목을 메시지로 전환하여 브로커에 발행<li><p>이 방식을 응용한 사례로는, 디비지움, 링크드인 데이터버스, DynamoDB, 이벤추에이트 트램 등이 있다.</p><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/142.jpg" height="60%" width="90%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/03/07/03/</figcaption></figure></ul><h1 id="동기-상호-방식-제거하기">동기 상호 방식 제거하기</h1><blockquote><p>요청을 처리하는 과정에서 타 서비스와 동기 통신을 하면 그만큼 가용성이 떨어지므로 <br /> 가능한 서비스가 비동기 메시징을 이용하여 통신하도록 설계하는 것이 바람직하다.</p></blockquote><h2 id="비동기-방식으로-처리">비동기 방식으로 처리</h2><ul><li><p>동기 방식으로 처리</p><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/147.jpg" height="60%" width="90%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/04/01/</figcaption></figure><li><p>비동기 방식으로 바꿔보기</p><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/148.jpg" height="60%" width="90%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/04/02/01/</figcaption></figure></ul><h2 id="데이터-복제">데이터 복제</h2><ul><li>서비스 요청 처리에 필요한 데이터의 레플리카를 유지하는 방법<li>데이터 레플리카를 통해 다른 서비스와 상호 작용할 필요가 없어진다.<li><p>하지만 대용량 데이터의 레플리카를 만드는 것은 매우 비효율적이다.</p><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/149.jpg" height="60%" width="90%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/04/02/02/</figcaption></figure></ul><h2 id="응답-반환-후-마무리">응답 반환 후 마무리</h2><figure align="center"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://thebook.io/img/007035/151.jpg" height="70%" width="90%" /><figcaption align="center">출처 : https://thebook.io/007035/ch03/04/02/03-01/</figcaption></figure><ul><li>주문 서비스는 다른 서비스를 호출하지 않은 채 주문을 생성한 후, 다른 서비스와 메시지를 교환하여 생성한 Order를 비동기적으로 검증한다.<li>이렇게 처리하면 다른 서비스가 내려가더라도 주문 서비스는 계속 주문을 생성하고 클라이언트에 응답을 할 수 있다. 나중에 문제가 됐던 서비스가 재기동 되면 큐에 쌓인 메시지를 처리하고 밀린 주문을 검증할 수 있다.<li>이처럼 요청을 완전히 처리하기 전에 클라이언트에 응답하는 서비스는 클라이언트가 조금 복잡해진다.<ul><li>클라이언트 입장에서 주문 생성 성공 여부를 알아내려면 주기적으로 폴링하거나 주문 서비스가 알림 메시지를 보내줘야 한다.<li>복잡하지만 동기 방식보다는 이게 더 나은 방법이다. 왜냐하면 분산 트랜잭션 관리 이슈를 이런 방식으로 해결할 수 있기 때문이다.</ul></ul><hr /><h1 id="실제로-적용해보기">실제로 적용해보기</h1><hr /><ul><li><a href="https://zz9z9.github.io/posts/my-wedding-manager-communication-architecture/">토이 프로젝트 ‘나만의 웨딩 매니저’ 통신 방식 구조</a></ul><h1 id="더-공부해야할-부분">더 공부해야할 부분</h1><hr /><ul><li>논블로킹 / 비동기<li>로그 테일링<li>메시지 브로커별 특징</ul><h1 id="참고-자료">참고 자료</h1><hr /><ul><li>크리스 리처드슨, 『마이크로서비스 패턴』, 길벗(2020), p104-152.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=마이크로서비스간 통신(3) - 비동기 방식 - zz9z9&url=https://zz9z9.github.io/posts/msa-pattern-chap3-3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=마이크로서비스간 통신(3) - 비동기 방식 - zz9z9&u=https://zz9z9.github.io/posts/msa-pattern-chap3-3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=마이크로서비스간 통신(3) - 비동기 방식 - zz9z9&url=https://zz9z9.github.io/posts/msa-pattern-chap3-3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-entity-manager-persistence-context/">EntityManager와 영속성 컨텍스트</a><li><a href="/posts/jpa-id-generation-strategy/">JPA/Hibernate ID 생성 전략</a><li><a href="/posts/aws-vpc/">AWS VPC(Virtual Private Cloud) - 기초 개념</a><li><a href="/posts/aws-efs/">AWS EFS(Elastic File System) - 기초 개념</a><li><a href="/posts/aws-intro/">AWS - 상품 살펴보기</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cautions-when-jpa-mybatis-together/"><div class="card-body"> <span class="timeago small" > Feb 10 <i class="unloaded">2026-02-10T22:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA / MyBatis 혼용시 주의사항 (in 배치 애플리케이션)</h3><div class="text-muted small"><p> JPA와 MyBatis는 서로의 존재를 모른다. MyBatis는 JDBC를 직접 사용하므로 JPA 영속성 컨텍스트를 우회하여 DB를 변경하고, JPA는 이를 감지할 수 없다. 결과적으로 JPA 1차 캐시에는 변경 전 데이터(stale data)가 남게 되어 데이터 불일치가 발생한다. 문제 상황 예시 1. 같은 엔티티를 JPA로 읽고 ...</p></div></div></a></div><div class="card"> <a href="/posts/how-jpa-item-writer-merge-works/"><div class="card-body"> <span class="timeago small" > Jan 29 <i class="unloaded">2026-01-29T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>이슈 - JpaItemWriter로 엔티티 저장시, ChunkSize만큼 SELECT 쿼리 발생하는 상황</h3><div class="text-muted small"><p> 상황 배치 애플리케이션에서 A 테이블에서 조회 -&gt; 가공 -&gt; B 테이블에 저장 흐름으로 동작하는 청크 기반의 Job이 있음 B 테이블에 저장시 JpaItemWriter 사용 B 테이블에 저장하는 엔티티의 PK는 A 테이블의 PK와 동일. 즉, A 테이블에서 조회한 엔티티의 PK가 사용됨 (Assigned ID + @Vers...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-id-generation-strategy/"><div class="card-body"> <span class="timeago small" > Jan 29 <i class="unloaded">2026-01-29T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JPA/Hibernate ID 생성 전략</h3><div class="text-muted small"><p> @GeneratedValue 기본 키(primary key) 값의 생성 전략을 지정하는 데 사용 즉, 데이터베이스에 새 레코드를 삽입할 때 기본 키 값을 자동으로 생성하는 방법을 지정 @GeneratedValue는 @Id와 함께 엔티티 또는 매핑된 슈퍼클래스의 기본 키 속성이나 필드에 적용할 수 있다. @GeneratedValu...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/msa-pattern-chap3-2/" class="btn btn-outline-primary" prompt="Older"><p>마이크로서비스간 통신(2) - 동기 방식</p></a> <a href="/posts/my-wedding-manager-table-architecture/" class="btn btn-outline-primary" prompt="Newer"><p>【나만의 웨딩 매니저】 DB 테이블 구성하기</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/username">Lee JaeYoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/hibernate/">Hibernate</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zz9z9.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
