<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀)" /><meta property="og:locale" content="en_US" /><meta name="description" content="상황 L4/L7 스위치 --- WEB --- WAS(애플리케이션)로 구성된 환경에서 2~3초 간격으로 L4/L7 스위치에서 헬스체크 신호를 보냄 애플리케이션은 헬스체크를 위해 DB에 SELECT 1 질의하게 되어있음 인프라팀 작업 이슈로 마스터 DB 서버 메모리 점유율이 너무 높아져 DB가 롤체인지 됨(약 12초 정도 소요) 롤체인지 되었는데도 애플리케이션 헬스체크는 down 상태 (DB 연결이 계속 안됨) 애플리케이션 재시작하니까 다시 정상 동작 이후에 DBA가 롤체인지 했을때 약 2초 정도 소요되었고, 헬스체크 잠깐 down 되었다가 다시 잘 올라옴" /><meta property="og:description" content="상황 L4/L7 스위치 --- WEB --- WAS(애플리케이션)로 구성된 환경에서 2~3초 간격으로 L4/L7 스위치에서 헬스체크 신호를 보냄 애플리케이션은 헬스체크를 위해 DB에 SELECT 1 질의하게 되어있음 인프라팀 작업 이슈로 마스터 DB 서버 메모리 점유율이 너무 높아져 DB가 롤체인지 됨(약 12초 정도 소요) 롤체인지 되었는데도 애플리케이션 헬스체크는 down 상태 (DB 연결이 계속 안됨) 애플리케이션 재시작하니까 다시 정상 동작 이후에 DBA가 롤체인지 했을때 약 2초 정도 소요되었고, 헬스체크 잠깐 down 되었다가 다시 잘 올라옴" /><link rel="canonical" href="https://zz9z9.github.io/posts/after-db-role-change-issue/" /><meta property="og:url" content="https://zz9z9.github.io/posts/after-db-role-change-issue/" /><meta property="og:site_name" content="zz9z9" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-10-14T22:25:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀)" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-21T23:40:36+09:00","datePublished":"2024-10-14T22:25:00+09:00","description":"상황 L4/L7 스위치 --- WEB --- WAS(애플리케이션)로 구성된 환경에서 2~3초 간격으로 L4/L7 스위치에서 헬스체크 신호를 보냄 애플리케이션은 헬스체크를 위해 DB에 SELECT 1 질의하게 되어있음 인프라팀 작업 이슈로 마스터 DB 서버 메모리 점유율이 너무 높아져 DB가 롤체인지 됨(약 12초 정도 소요) 롤체인지 되었는데도 애플리케이션 헬스체크는 down 상태 (DB 연결이 계속 안됨) 애플리케이션 재시작하니까 다시 정상 동작 이후에 DBA가 롤체인지 했을때 약 2초 정도 소요되었고, 헬스체크 잠깐 down 되었다가 다시 잘 올라옴","headline":"DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀)","mainEntityOfPage":{"@type":"WebPage","@id":"https://zz9z9.github.io/posts/after-db-role-change-issue/"},"url":"https://zz9z9.github.io/posts/after-db-role-change-issue/"}</script><title>DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀) | zz9z9</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zz9z9"><meta name="application-name" content="zz9z9"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q7PWLG5WYT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q7PWLG5WYT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Soccerball.svg/1000px-Soccerball.svg.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zz9z9</a></div><div class="site-subtitle font-italic">거창한 계획보다는, 꾸준한 실행을</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zz9z9" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lee JaeYoon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 14, 2024, 10:25 PM +0900" prep="on" > Oct 14, 2024 <i class="unloaded">2024-10-14T22:25:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Nov 21, 2024, 11:40 PM +0900" prefix="Updated " > Nov 21, 2024 <i class="unloaded">2024-11-21T23:40:36+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="931 words">5 min</span></div></div><div class="post-content"><h2 id="상황">상황</h2><ul><li><code class="language-plaintext highlighter-rouge">L4/L7 스위치 --- WEB --- WAS(애플리케이션)</code>로 구성된 환경에서 2~3초 간격으로 <code class="language-plaintext highlighter-rouge">L4/L7 스위치</code>에서 헬스체크 신호를 보냄<li>애플리케이션은 헬스체크를 위해 DB에 <code class="language-plaintext highlighter-rouge">SELECT 1</code> 질의하게 되어있음<li>인프라팀 작업 이슈로 마스터 DB 서버 메모리 점유율이 너무 높아져 DB가 롤체인지 됨(약 12초 정도 소요)<li>롤체인지 되었는데도 애플리케이션 헬스체크는 down 상태 (DB 연결이 계속 안됨)<li>애플리케이션 재시작하니까 다시 정상 동작<li>이후에 DBA가 롤체인지 했을때 약 2초 정도 소요되었고, 헬스체크 잠깐 down 되었다가 다시 잘 올라옴</ul><p><strong><em>“왜 롤체인지에 12초가 걸렸을 때는 DB가 정상화되었는데도 연결이 안됐고, 2초가 걸렸을 때는 다시 연결이 잘 됐을까 ?”</em></strong></p><h2 id="에러-로그-살펴보기">에러 로그 살펴보기</h2><h3 id="롤체인지-12초">롤체인지 12초</h3><blockquote><p>1, 2, 3 순서대로 나타난 후, 3번이 계속 반복됨</p></blockquote><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>1. com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure
2. java.sql.SQLNonTransientConnectionException: Could not create connection to database server. Attempted reconnect 3 times. Giving up.
3. java.sql.SQLNonTransientConnectionException: No operations allowed after connection closed.
</pre></table></code></div></div><h3 id="롤체인지-2초">롤체인지 2초</h3><ul><li><code class="language-plaintext highlighter-rouge">com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure</code></ul><h2 id="db-관련-설정-살펴보기">db 관련 설정 살펴보기</h2><ul><li>db 접속 정보<blockquote><p>autoReconnect가 사용되고 있음</p></blockquote></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>jdbc:mysql://{ip}:{port}/{db}?autoReconnect=true&amp;useLocalSessionState=true
</pre></table></code></div></div><ul><li>커넥션 풀(<a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html#Introduction">톰캣 DBCP</a>) eviction 스레드 관련 설정</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">dataSource</span><span class="o">.</span><span class="na">setTestOnBorrow</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">dataSource</span><span class="o">.</span><span class="na">setTestOnReturn</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">dataSource</span><span class="o">.</span><span class="na">setTestWhileIdle</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</pre></table></code></div></div><h2 id="원인-파악하기">원인 파악하기</h2><blockquote><p>디버깅한 것을 바탕으로 간단하게 나타낸 그림 (틀릴 수 있음)</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img1.png" alt="image" /></p><h3 id="롤체인지-12초-때의-애플리케이션-실행-흐름">롤체인지 12초 때의 애플리케이션 실행 흐름</h3><blockquote><p>하나의 DB 커넥션 관점에서의 흐름</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img2.png" alt="image" /></p><ol><li>L4에서 헬스체크 요청 들어옴 -&gt; DB에 질의 요청<li>질의 실패 ( <code class="language-plaintext highlighter-rouge">autoReconnect</code> true이면, 다음 질의 때 질의 날리기 전 먼저 ping 검사하라는 변수(<code class="language-plaintext highlighter-rouge">needsPing</code>)를 true로 만듦)<ul><li><code class="language-plaintext highlighter-rouge">Communications link failure</code> 예외 발생 <strong>(health check down)</strong></ul><li>L4에서 헬스체크 요청 들어옴 -&gt; DB에 질의 요청전 먼저 ping 검사 수행<li>ping 실패시 DB 세션에 다시 연결(reconnect)하는 과정 수행<li>(먼저 NativeSession close 후) reconnect 최대 재시도 횟수(default : 3)까지 실패<ul><li><code class="language-plaintext highlighter-rouge">Could not create connection to database server. Attempted reconnect 3 times. Giving up.</code> 예외 발생</ul><li>L4에서 헬스체크 요청 들어옴 -&gt; DB 질의를 위해 <code class="language-plaintext highlighter-rouge">PreparedStatement</code> 만드는 과정에서 커넥션에 매핑된 <code class="language-plaintext highlighter-rouge">NativeSession</code>이 닫혀있는지 먼저 확인<ul><li>5번에서 NativeSession close하고 재연결에도 실패했기 때문에 NativeSession은 닫혀있는 상태이므로, <code class="language-plaintext highlighter-rouge">No operations allowed after connection closed.</code> 예외 발생<li>즉, NativeSession만 체크하고 예외 던지므로 DB가 롤체인지 되어 살아난 것과는 관계없이 질의를 할 수 없게됨</ul></ol><p><strong>※ 롤체인지 2초때는 3또는 4에서 성공한 것으로 보임</strong></p><h3 id="실행-흐름-코드-참고">실행 흐름 코드 참고</h3><ul><li>1~4 : <code class="language-plaintext highlighter-rouge">com.mysql.cj.NativeSession#execSQL</code> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img3.png" alt="image" /><li>5 : <code class="language-plaintext highlighter-rouge">com.mysql.cj.jdbc.ConnectionImpl#connectWithRetries</code> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img4.png" alt="image" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img5.png" alt="image" /><li><code class="language-plaintext highlighter-rouge">com.mysql.cj.LocalizedErrorMessage.properties</code> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img6.png" alt="image" /><li>6 : <code class="language-plaintext highlighter-rouge">com.mysql.cj.jdbc.ConnectionImpl#prepareStatement</code>,<code class="language-plaintext highlighter-rouge">com.mysql.cj.NativeSession#checkClosed</code> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img7.png" alt="image" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img8.png" alt="image" /><li><code class="language-plaintext highlighter-rouge">com.mysql.cj.LocalizedErrorMessage.properties</code> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://cdn.jsdelivr.net/gh/zz9z9/zz9z9.github.io@master/assets/img/after-role-change-issue-img9.png" alt="image" /></ul><h2 id="조치">조치</h2><blockquote><p>더 이상 유효하지 않은 DB 세션을 물고있는 커넥션을 커넥션 풀에서 정리</p></blockquote><h3 id="커넥션-풀-옵션-변경">커넥션 풀 옵션 변경</h3><ul><li>AS-IS</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">dataSource</span><span class="o">.</span><span class="na">setTestOnBorrow</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">dataSource</span><span class="o">.</span><span class="na">setTestOnReturn</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">dataSource</span><span class="o">.</span><span class="na">setTestWhileIdle</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</pre></table></code></div></div><ul><li>TO-BE</ul><blockquote><p><code class="language-plaintext highlighter-rouge">PoolCleaner</code>(<code class="language-plaintext highlighter-rouge">org.apache.tomcat.jdbc.pool.ConnectionPool.PoolCleaner</code>)가 5초(<code class="language-plaintext highlighter-rouge">timeBetweenEvictionRunsMillis</code> 기본값)에 한번씩 idle 큐에 있는 커넥션들의 DB 세션 유효성 검사</p></blockquote><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">dataSource</span><span class="o">.</span><span class="na">setTestOnBorrow</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">dataSource</span><span class="o">.</span><span class="na">setTestOnReturn</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">dataSource</span><span class="o">.</span><span class="na">setTestWhileIdle</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">dataSource</span><span class="o">.</span><span class="na">setValidationQuery</span><span class="o">(</span><span class="s">"SELECT 1"</span><span class="o">);</span>
<span class="n">dataSource</span><span class="o">.</span><span class="na">setMinEvictableIdleTimeMillis</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span>
</pre></table></code></div></div><h3 id="헬스체크-방식-변경">헬스체크 방식 변경</h3><ul><li>DB에 질의하지 않고 애플리케이션이 실행되고 있는지 여부로 판단하도록 <br />(요청 자체가 못들어오는 것보다는 서버 에러라고 응답 주는게 낫다고 생각)</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EA%B2%BD%ED%97%98%ED%95%98%EA%B8%B0/'>경험하기</a>, <a href='/categories/%EC%9D%B4%EC%8A%88-%EB%85%B8%ED%8A%B8/'>이슈 노트</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dbcp/" class="post-tag no-text-decoration" >DBCP</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀) - zz9z9&url=https://zz9z9.github.io/posts/after-db-role-change-issue/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀) - zz9z9&u=https://zz9z9.github.io/posts/after-db-role-change-issue/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=DB 롤체인지 후 애플리케이션 헬스체크가 정상적으로 되지 않은 이슈 (feat. DB 커넥션 풀) - zz9z9&url=https://zz9z9.github.io/posts/after-db-role-change-issue/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/daily-note-251016/">오늘 드는 생각 (251016, 은탄환)</a><li><a href="/posts/daily-note-251015/">오늘 드는 생각 (251015, 일과 공부)</a><li><a href="/posts/thinking-about-maintenance/">유지보수하기 어렵다 ?</a><li><a href="/posts/mysql-nested-loop-join/">MySQL - Nested-Loop Join 알아보기</a><li><a href="/posts/mysql-hash-join/">MySQL - Hash Join 알아보기</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a> <a class="post-tag" href="/tags/oop/">OOP</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/os/">OS</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/xssf-oom-analyze/"><div class="card-body"> <span class="timeago small" > Jul 23, 2021 <i class="unloaded">2021-07-23T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>XSSF로 인한 OOM 에러 그리고 SXSSF와 메모리 사용량 비교해보기</h3><div class="text-muted small"><p> 상황 이 글 에서 언급했듯이, poi 라이브러리를 활용해서 엑셀을 만들 때, XSSF 클래스를 사용하면 데이터 건수(엑셀 row)가 많은 경우 OOM 에러가 발생한다. XSSF를 개선한 SXSSF를 사용하면 해당 문제를 해결할 수 있다고 하는데, 실제로 메모리 사용량을 비교해보고자 한다. 메모리 단면을 분석하는 방법은 ...</p></div></div></a></div><div class="card"> <a href="/posts/try-with-resource-caution/"><div class="card-body"> <span class="timeago small" > Sep 5, 2021 <i class="unloaded">2021-09-05T14:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>try-with-resource 사용시 Socket closed 예외 발생</h3><div class="text-muted small"><p> 상황 자바로 만든 간단한 웹 서버에서 404, 500과 같은 에러 페이지 처리를 위해 catch 절 내부에 에러 페이지를 응답하는 로직을 작성했다. 하지만 에러 발생시 에러 페이지가 응답되지 않고 java.net.SocketException: Socket closed가 발생했다. public class HttpServer { ... ...</p></div></div></a></div><div class="card"> <a href="/posts/ie-doesnt-support-issue/"><div class="card-body"> <span class="timeago small" > Dec 6, 2021 <i class="unloaded">2021-12-06T23:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IE에서 작동하지 않는 자바스크립트 코드</h3><div class="text-muted small"><p> 상황 회사에서 맡은 작업을 로컬 환경에서 개발/테스트하고 개발 환경에 배포하여 잘 동작하는지 테스트해봤다. 로컬에서 여러 번의 테스트 결과 별이상 없었기 때문에 당연히 되겠지하고 ‘조회’ 버튼을 누르는데 아무런 반응이 없었다… IE 개발자 도구를 통해 콘솔을 확인해보니, 서버에서 응답받은 js 파일 중 하나에서 SCRIPT1004: ';'가 필요...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/4bytes-emoji-to-question-marks/" class="btn btn-outline-primary" prompt="Older"><p>MySQL에서 4bytes 이모지가 물음표로 저장되는 이슈</p></a> <a href="/posts/response-timeout(caller)/" class="btn btn-outline-primary" prompt="Newer"><p>API 호출시 타임아웃이 발생하면 ? (caller 관점에서)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Lee JaeYoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a> <a class="post-tag" href="/tags/oop/">OOP</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/os/">OS</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zz9z9.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
