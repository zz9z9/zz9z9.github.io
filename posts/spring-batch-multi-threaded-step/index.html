<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Spring Batch - Multi-threaded Step 알아보기" /><meta property="og:locale" content="en_US" /><meta name="description" content="개요" /><meta property="og:description" content="개요" /><link rel="canonical" href="https://zz9z9.github.io/posts/spring-batch-multi-threaded-step/" /><meta property="og:url" content="https://zz9z9.github.io/posts/spring-batch-multi-threaded-step/" /><meta property="og:site_name" content="zz9z9" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-08-23T12:25:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring Batch - Multi-threaded Step 알아보기" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-08-23T12:25:00+09:00","datePublished":"2025-08-23T12:25:00+09:00","description":"개요","headline":"Spring Batch - Multi-threaded Step 알아보기","mainEntityOfPage":{"@type":"WebPage","@id":"https://zz9z9.github.io/posts/spring-batch-multi-threaded-step/"},"url":"https://zz9z9.github.io/posts/spring-batch-multi-threaded-step/"}</script><title>Spring Batch - Multi-threaded Step 알아보기 | zz9z9</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zz9z9"><meta name="application-name" content="zz9z9"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Q7PWLG5WYT"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Q7PWLG5WYT'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Soccerball.svg/1000px-Soccerball.svg.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zz9z9</a></div><div class="site-subtitle font-italic">거창한 계획보다는, 꾸준한 실행을</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zz9z9" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Spring Batch - Multi-threaded Step 알아보기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring Batch - Multi-threaded Step 알아보기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lee JaeYoon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Aug 23, 2025, 12:25 PM +0900" prep="on" > Aug 23 <i class="unloaded">2025-08-23T12:25:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1595 words">8 min</span></div></div><div class="post-content"><h2 id="개요">개요</h2><hr /><ul><li>Spring Batch는 병렬 처리를 위한 다양한 옵션을 제공한다.<li>큰 틀에서 병렬 처리는 두 가지 방식이 있다:<ul><li><strong>Single-process</strong><ul><li>Multi-threaded Step<li>Parallel Steps</ul><li><strong>Multi-process</strong><ul><li>Remote Chunking of Step<li>Partitioning a Step (Single or Multi-process)</ul></ul></ul><h2 id="multi-threaded-step">Multi-threaded Step</h2><hr /><blockquote><p>병렬 처리를 시작하는 가장 단순한 방법은 Step 설정에 TaskExecutor를 추가하는 것</p></blockquote><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">TaskExecutor</span> <span class="nf">taskExecutor</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">SimpleAsyncTaskExecutor</span><span class="o">(</span><span class="s">"spring_batch"</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">Step</span> <span class="nf">sampleStep</span><span class="o">(</span><span class="nc">TaskExecutor</span> <span class="n">taskExecutor</span><span class="o">,</span> <span class="nc">JobRepository</span> <span class="n">jobRepository</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nf">StepBuilder</span><span class="o">(</span><span class="s">"sampleStep"</span><span class="o">,</span> <span class="n">jobRepository</span><span class="o">)</span>
				<span class="o">.&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span><span class="n">chunk</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">transactionManager</span><span class="o">)</span>
				<span class="o">.</span><span class="na">reader</span><span class="o">(</span><span class="n">itemReader</span><span class="o">())</span>
				<span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="n">itemWriter</span><span class="o">())</span>
				<span class="o">.</span><span class="na">taskExecutor</span><span class="o">(</span><span class="n">taskExecutor</span><span class="o">)</span>
        <span class="o">.</span><span class="na">throttleLimit</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="c1">// default : 4 (스프링 배치 5.0부터는 deprecated)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li>위 설정을 통해, Step이 실행될 때 <strong>각 청크(커밋 단위)를 별도의 스레드에서</strong> 읽고, 처리하고, 쓰게 된다.<li>따라서 아이템들이 순차적으로 처리되지 않을 수 있으며, 단일 스레드의 경우와 달리 한 청크에 연속되지 않는 아이템이 포함될 수도 있습니다.<li>추가로, taskExecutor 자체의 제한(예: 스레드 풀이냐 아니냐) 외에도, tasklet 설정에는 throttleLimit(기본값: 4)이 존재합니다.<ul><li>즉, 동시에 최대 4개의 청크만 병렬 실행</ul><li>스레드 풀을 충분히 활용하려면 이 제한을 늘려야 할 수도 있습니다.</ul><h3 id="throttle-limit-폐기">Throttle limit 폐기</h3><ul><li>버전 5.0부터 throttle limit은 deprecated 되었으며 대체제가 없습니다.<li>현재 기본 <code class="language-plaintext highlighter-rouge">TaskExecutorRepeatTemplate</code>에서 쓰이는 쓰로틀링 메커니즘을 바꾸고 싶다면, bounded task queue를 가진 TaskExecutor 기반의 커스텀 RepeatOperations 구현체를 만들어서, <code class="language-plaintext highlighter-rouge">StepBuilder#stepOperations</code>에 넣어야 합니다:</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">Step</span> <span class="nf">sampleStep</span><span class="o">(</span><span class="nc">RepeatOperations</span> <span class="n">customRepeatOperations</span><span class="o">,</span> <span class="nc">JobRepository</span> <span class="n">jobRepository</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">StepBuilder</span><span class="o">(</span><span class="s">"sampleStep"</span><span class="o">,</span> <span class="n">jobRepository</span><span class="o">)</span>
                <span class="o">.&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span><span class="n">chunk</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">transactionManager</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reader</span><span class="o">(</span><span class="n">itemReader</span><span class="o">())</span>
                <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="n">itemWriter</span><span class="o">())</span>
                <span class="o">.</span><span class="na">stepOperations</span><span class="o">(</span><span class="n">customRepeatOperations</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="주의사항">주의사항</h3><ul><li>Step의 많은 구성 요소(예: Reader, Writer)는 stateful 합니다.<ul><li><code class="language-plaintext highlighter-rouge">FlatFileItemReader</code>는 파일 포인터(cursor)를 갖고 있어서 여러 스레드가 동시에 접근하면 꼬임.<li><code class="language-plaintext highlighter-rouge">JdbcCursorItemReader</code>도 DB 커서 기반이라 멀티스레드에 적합하지 않음.<li>반면, <code class="language-plaintext highlighter-rouge">JdbcPagingItemReader</code>는 Stateless Reader</ul><li>만약 이 상태가 스레드별로 분리되지 않는다면, 멀티스레드 Step에서는 사용할 수 없습니다.<li>특히, Spring Batch가 제공하는 대부분의 Reader와 Writer는 멀티스레드 용도로 설계되지 않았습니다.<li>그러나, stateless 또는 thread-safe한 Reader/Writer를 사용한다면 가능하며, <a href="https://github.com/spring-projects/spring-batch/tree/main/spring-batch-samples">Spring Batch 샘플</a>에서는 DB 입력 테이블에 <strong>처리 여부 플래그(process indicator)</strong>를 두어 어떤 아이템이 이미 처리되었는지 추적하는 방법을 보여줍니다.<li>Spring Batch는 일부 ItemWriter, ItemReader 구현을 제공합니다.<ul><li>Javadoc에 thread-safe 여부 또는 동시성 환경에서 피해야 할 문제가 명시되어 있는 경우가 많습니다.<li>정보가 없다면 구현체를 직접 확인해 상태(state)가 있는지 살펴야 합니다.</ul><li>만약 Reader가 thread-safe하지 않다면, <code class="language-plaintext highlighter-rouge">SynchronizedItemStreamReader</code>로 감싸거나, 직접 동기화 래퍼를 구현할 수 있습니다.<li>read() 호출을 동기화하면, 비록 읽기 자체는 직렬화되더라도, 처리(processing)와 쓰기(writing) 단계가 청크 내에서 가장 비용이 큰 부분이라면, 전체 Step은 여전히 싱글스레드보다 훨씬 빠르게 끝날 수 있습니다.</ul><h2 id="예시">예시</h2><hr /><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="nd">@EnableBatchProcessing</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderBatchConfig</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">OrderBatchConfig</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 멀티스레드용 TaskExecutor</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ThreadPoolTaskExecutor</span> <span class="nf">taskExecutor</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ThreadPoolTaskExecutor</span> <span class="n">executor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadPoolTaskExecutor</span><span class="o">();</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setCorePoolSize</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>   <span class="c1">// 동시에 실행할 스레드 수</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>    <span class="c1">// 최대 스레드 수도 동일하게 설정</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setQueueCapacity</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>  <span class="c1">// bounded queue → 무한 큐 방지</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">setThreadNamePrefix</span><span class="o">(</span><span class="s">"spring_batch-"</span><span class="o">);</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">executor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Reader (페이징 기반, 멀티스레드 안전)</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">JdbcPagingItemReader</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="nf">orderReader</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">JdbcPagingItemReader</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JdbcPagingItemReader</span><span class="o">&lt;&gt;();</span>
        <span class="n">reader</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="n">reader</span><span class="o">.</span><span class="na">setPageSize</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>

        <span class="nc">SqlPagingQueryProviderFactoryBean</span> <span class="n">queryProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlPagingQueryProviderFactoryBean</span><span class="o">();</span>
        <span class="n">queryProvider</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="n">queryProvider</span><span class="o">.</span><span class="na">setSelectClause</span><span class="o">(</span><span class="s">"id, customer_id, status"</span><span class="o">);</span>
        <span class="n">queryProvider</span><span class="o">.</span><span class="na">setFromClause</span><span class="o">(</span><span class="s">"from orders"</span><span class="o">);</span>
        <span class="n">queryProvider</span><span class="o">.</span><span class="na">setWhereClause</span><span class="o">(</span><span class="s">"where status = 'NEW'"</span><span class="o">);</span>
        <span class="n">queryProvider</span><span class="o">.</span><span class="na">setSortKeys</span><span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">Order</span><span class="o">.</span><span class="na">ASCENDING</span><span class="o">));</span>

        <span class="n">reader</span><span class="o">.</span><span class="na">setQueryProvider</span><span class="o">(</span><span class="n">queryProvider</span><span class="o">.</span><span class="na">getObject</span><span class="o">());</span>

        <span class="n">reader</span><span class="o">.</span><span class="na">setRowMapper</span><span class="o">((</span><span class="n">rs</span><span class="o">,</span> <span class="n">rowNum</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">Order</span><span class="o">(</span>
                <span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"id"</span><span class="o">),</span>
                <span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"customer_id"</span><span class="o">),</span>
                <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"status"</span><span class="o">)</span>
        <span class="o">));</span>
        <span class="k">return</span> <span class="n">reader</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Processor (상태 변경)</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ItemProcessor</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">,</span> <span class="nc">Order</span><span class="o">&gt;</span> <span class="nf">orderProcessor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">order</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="s">"PROCESSED"</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
        <span class="o">};</span>
    <span class="o">}</span>

    <span class="c1">// Writer (Batch update)</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">JdbcBatchItemWriter</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="nf">orderWriter</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">JdbcBatchItemWriterBuilder</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;()</span>
                <span class="o">.</span><span class="na">dataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">)</span>
                <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"UPDATE orders SET status = :status WHERE id = :id"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">beanMapped</span><span class="o">()</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// Step 정의 (멀티스레드 적용)</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Step</span> <span class="nf">processOrdersStep</span><span class="o">(</span><span class="nc">JobRepository</span> <span class="n">jobRepository</span><span class="o">,</span> <span class="nc">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">StepBuilder</span><span class="o">(</span><span class="s">"processOrdersStep"</span><span class="o">,</span> <span class="n">jobRepository</span><span class="o">)</span>
                <span class="o">.&lt;</span><span class="nc">Order</span><span class="o">,</span> <span class="nc">Order</span><span class="o">&gt;</span><span class="n">chunk</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">transactionManager</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reader</span><span class="o">(</span><span class="n">orderReader</span><span class="o">())</span>
                <span class="o">.</span><span class="na">processor</span><span class="o">(</span><span class="n">orderProcessor</span><span class="o">())</span>
                <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="n">orderWriter</span><span class="o">())</span>
                <span class="o">.</span><span class="na">taskExecutor</span><span class="o">(</span><span class="n">taskExecutor</span><span class="o">())</span>   <span class="c1">// 멀티스레드 실행</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// Job 정의</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Job</span> <span class="nf">orderJob</span><span class="o">(</span><span class="nc">JobRepository</span> <span class="n">jobRepository</span><span class="o">,</span> <span class="nc">Step</span> <span class="n">processOrdersStep</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">JobBuilder</span><span class="o">(</span><span class="s">"orderJob"</span><span class="o">,</span> <span class="n">jobRepository</span><span class="o">)</span>
                <span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">processOrdersStep</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="페이징-처리-방식">페이징 처리 방식</h3><ul><li><code class="language-plaintext highlighter-rouge">JdbcPagingItemReader</code>는 <code class="language-plaintext highlighter-rouge">pageSize</code> 단위로 쿼리를 실행해서 데이터를 가져옵니다.<li>예를 들어, 전체 조회 대상이 10000개이고 pageSize=100이면:<ul><li>1차 쿼리 : <code class="language-plaintext highlighter-rouge">where status='NEW' order by id limit 100 offset 0</code><li>2차 쿼리 : <code class="language-plaintext highlighter-rouge">where status='NEW' order by id limit 100 offset 100</code><li>이런 식으로 쿼리를 날려서 10000개를 끊어서 가져옵니다. 따라서 중복 없이 전체 10000개를 다 읽습니다.<br /> (단, 여기서 정렬 기준 <code class="language-plaintext highlighter-rouge">sortKeys</code>를 반드시 지정해야 안정적으로 paging이 됩니다. 보통 id ASC 같은 단일 PK 기준을 많이 씁니다.)</ul></ul><h3 id="pagesize--chunksize-이면-">pageSize &gt; chunkSize 이면 ?</h3><blockquote><p>총 대상 데이터 : 10,000개 (status=NEW) <br /> chunkSize = 100 <br /> pageSize = 1000</p></blockquote><ul><li>Reader<ul><li>DB에서 1000개를 한 번에 select 해와서 메모리에 들고 있음.<li>예: id 1 ~ 1000</ul><li>Processor &amp; Writer<ul><li>읽어온 1000개 중 100개씩 잘라서 Processor → Writer → commit 실행.<li>즉, 같은 1000개 데이터를 내부 버퍼에서 10번(=1000/100) 반복해서 처리.</ul><li>다음 Reader 호출<ul><li>Reader가 다시 DB에 쿼리 → 다음 1000개(id 1001~2000) 가져옴.<li>그 안에서도 chunk 단위(100)로 나눠서 10번 commit.</ul><li>결과<ul><li>DB는 10번(=10000 / 1000)만 조회함.<li>Processor/Writer는 여전히 100개 단위로 동작해서 총 100번 commit(=10000 / 100).<li>즉, pageSize는 “DB fetch 단위”, <strong>chunkSize는 “트랜잭션 처리 단위”</strong>라는 점이 드러남.</ul></ul><h2 id="참고-자료">참고 자료</h2><hr /><ul><li><a href="https://docs.spring.io/spring-batch/reference/scalability.html">https://docs.spring.io/spring-batch/reference/scalability.html</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EC%A7%80%EC%8B%9D-%EB%8D%94%ED%95%98%EA%B8%B0/'>지식 더하기</a>, <a href='/categories/%EC%9D%B4%EB%A1%A0/'>이론</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring-batch/" class="post-tag no-text-decoration" >Spring Batch</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring Batch - Multi-threaded Step 알아보기 - zz9z9&url=https://zz9z9.github.io/posts/spring-batch-multi-threaded-step/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring Batch - Multi-threaded Step 알아보기 - zz9z9&u=https://zz9z9.github.io/posts/spring-batch-multi-threaded-step/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Spring Batch - Multi-threaded Step 알아보기 - zz9z9&url=https://zz9z9.github.io/posts/spring-batch-multi-threaded-step/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/daily-note-251016/">오늘 드는 생각 (251016, 은탄환)</a><li><a href="/posts/daily-note-251015/">오늘 드는 생각 (251015, 일과 공부)</a><li><a href="/posts/thinking-about-maintenance/">유지보수하기 어렵다 ?</a><li><a href="/posts/mysql-nested-loop-join/">MySQL - Nested-Loop Join 알아보기</a><li><a href="/posts/mysql-hash-join/">MySQL - Hash Join 알아보기</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a> <a class="post-tag" href="/tags/oop/">OOP</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/os/">OS</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/what-is-spring-batch/"><div class="card-body"> <span class="timeago small" > Aug 22 <i class="unloaded">2025-08-22T21:25:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Batch 알아보기</h3><div class="text-muted small"><p> Spring Batch Spring Batch는 엔터프라이즈 시스템의 핵심 일상 업무(vital for the daily operations)를 위한 견고한 배치 애플리케이션 개발을 지원하는 경량·종합 프레임워크 Spring Batch는 생산성, POJO 기반 개발, 쉬운 사용성 같은 스프링 특성을 계승하면서, 필요 시 고급 엔터프라...</p></div></div></a></div><div class="card"> <a href="/posts/spring-batch-job/"><div class="card-body"> <span class="timeago small" > Sep 5 <i class="unloaded">2025-09-05T21:25:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Batch - Job 개념</h3><div class="text-muted small"><p> 개념 Job 배치 작업 (출처 : https://docs.spring.io/spring-batch/reference/domain.html) 하나의 Job은 하나 이상의 Step을 가지며, 각각의 Step은 하나의 ItemReader, 하나의 ItemProcessor, 그리고 하나의 ItemWriter를 가진다. 즉, Job은 ...</p></div></div></a></div><div class="card"> <a href="/posts/spring-batch-step/"><div class="card-body"> <span class="timeago small" > Sep 18 <i class="unloaded">2025-09-18T22:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Batch - Step 개념</h3><div class="text-muted small"><p> 개념 Step Batch Job을 구성하는 독립된 작업 BATCH_STEP_EXECUTION 테이블에 저장됨 해당 Step을 포함하는 JobExecution 정보(JOB_EXECUTION_ID)도 기록됨 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/what-is-spring-batch/" class="btn btn-outline-primary" prompt="Older"><p>Spring Batch 알아보기</p></a> <a href="/posts/what-is-gradle/" class="btn btn-outline-primary" prompt="Newer"><p>Gradle 알아보기</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Lee JaeYoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/web/">WEB</a> <a class="post-tag" href="/tags/infra/">Infra</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/spring-batch/">Spring Batch</a> <a class="post-tag" href="/tags/oop/">OOP</a> <a class="post-tag" href="/tags/mybatis/">MyBatis</a> <a class="post-tag" href="/tags/os/">OS</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zz9z9.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
